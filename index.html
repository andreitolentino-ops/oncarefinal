<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ONE CARE SYSTEM — Modern Healthcare EHR</title>

  <!-- Preload critical resources -->
  <link rel="preload" href="style.css" as="style">
  <link rel="preload" href="app.js" as="script">
  
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css">
  
  <!-- Progressive Web App capabilities -->
  <meta name="theme-color" content="#0f766e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="One Care System">
</head>
<body class="bg-slate-50 text-slate-700 min-h-screen antialiased transition-colors duration-500">

  <!-- App header: logo, breadcrumb, search, actions -->
  <header class="app-header w-full py-4 px-6 bg-white/70 glass border-b sticky top-0 z-40">
    <div class="max-w-7xl mx-auto flex items-center justify-between gap-4">
      <div class="header-left flex items-center gap-4">
        <div class="header-logo flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-sky-600 to-indigo-700 text-white flex items-center justify-center text-lg">🩺</div>
          <div class="leading-tight">
            <div class="font-bold text-slate-800">ONE CARE <span class="text-amber-400">SYSTEM</span></div>
            <div class="text-xs text-slate-500">Modern EHR</div>
          </div>
        </div>
        <div class="breadcrumb ml-4 text-sm text-slate-600">
          <span id="breadcrumb-current">Dashboard</span>
        </div>
      </div>

      <div class="header-center flex-1 px-4">
        <div class="max-w-xl mx-auto relative">
          <input id="searchTop" type="search" placeholder="Search patients, MRN, physician... (press /)" class="w-full rounded-lg p-3 border" />
          <div class="absolute right-3 top-1/2 -translate-y-1/2 text-xs text-slate-400">/</div>
        </div>
      </div>

      <div class="header-right flex items-center gap-3">
        <div id="userDisplayName" class="text-sm text-slate-700 font-medium">
          <span id="currentUserName">Not signed in</span> 
          <span id="currentUserRole" class="text-xs text-slate-500 ml-1">(GUEST)</span>
        </div>
        <div id="userInfo" class="text-sm text-slate-700">
          <div class="relative" id="userMenuWrap">
            <button id="userMenuBtn" class="flex items-center gap-2 px-3 py-1 rounded bg-white/10">
              <span id="userMenuEmail" class="font-medium">Not signed in</span>
              <span class="text-xs opacity-60">▾</span>
            </button>
            <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 rounded bg-white shadow p-0 z-50">
              <div class="text-sm p-3 border-b">
                <strong id="userMenuEmailStrong">Not signed in</strong>
                <div id="userRole" class="text-xs text-slate-500">GUEST</div>
              </div>
              <button id="themeToggleBtn" class="w-full text-left px-3 py-2 text-sm hover:bg-slate-50">Toggle theme</button>
              <button id="userSignOut" class="w-full text-left px-3 py-2 text-sm text-rose-600 hover:bg-slate-50">Sign out</button>
            </div>
          </div>
        </div>
        
        <button id="helpBtn" class="btn btn-ghost" title="Help & Documentation">❓</button>
        <button id="btnLogout" class="btn btn-ghost" title="Logout">Sign out</button>
      </div>
    </div>
  </header>

  <!-- Top Navigation Bar -->
  <div class="top-nav-wrap">
    <div class="top-nav-container">
      <nav class="top-nav" id="topNav">
        <button type="button" data-target="tab-dashboard" data-label="Dashboard" title="Dashboard" class="navbtn icon-only" aria-label="Dashboard">
          <span class="nav-icon">🏠</span>
        </button>
        <button type="button" data-target="tab-departments" data-label="Departments & Beds" title="Departments & Beds" class="navbtn icon-only" aria-label="Departments & Beds">
          <span class="nav-icon">🏥</span>
        </button>
        <button type="button" data-target="tab-info" data-label="Patient Information" title="Patient Information" class="navbtn icon-only" aria-label="Patient Information">
          <span class="nav-icon">👤</span>
        </button>
        <button type="button" data-target="tab-id" data-label="Identification" title="Identification & Insurance" class="navbtn icon-only" aria-label="Identification & Insurance">
          <span class="nav-icon">🆔</span>
        </button>
        <button type="button" data-target="tab-history" data-label="Medical History" title="Medical History" class="navbtn icon-only" aria-label="Medical History">
          <span class="nav-icon">📋</span>
        </button>
        <button type="button" data-target="tab-physical" data-label="Physical Assessment" title="Physical Assessment" class="navbtn icon-only" aria-label="Physical Assessment">
          <span class="nav-icon">🔍</span>
        </button>
        <button type="button" data-target="tab-assessment" data-label="Treatment Plan" title="Treatment Plan" class="navbtn icon-only" aria-label="Treatment Plan">
          <span class="nav-icon">⚕️</span>
        </button>
        <button type="button" data-target="tab-labs" data-label="Labs" title="Laboratory & Diagnostics" class="navbtn icon-only" aria-label="Laboratory & Diagnostics">
          <span class="nav-icon">🧪</span>
        </button>
        <button type="button" data-target="tab-meds" data-label="Medication & IV Order" title="Medication & IV Order" class="navbtn icon-only" aria-label="Medication & IV Order">
          <span class="nav-icon">💊</span>
        </button>
        <button type="button" data-target="tab-messages" data-label="Messages" title="Clinical Messages & Alerts" class="navbtn icon-only" aria-label="Clinical Messages & Alerts">
          <span class="nav-icon">💬</span>
        </button>
        <button type="button" data-target="tab-vitals" data-label="Vitals" title="Vitals & Monitoring" class="navbtn icon-only" aria-label="Vitals & Monitoring">
          <span class="nav-icon">📊</span>
        </button>
        <button type="button" data-target="tab-nurse" data-label="Nurse Notes" title="Nurse Notes (FDAR)" class="navbtn icon-only" aria-label="Nurse Notes">
          <span class="nav-icon">👩‍⚕️</span>
        </button>
        <button type="button" data-target="tab-doctor" data-label="Doctor Notes" title="Doctor Notes" class="navbtn icon-only" aria-label="Doctor Notes">
          <span class="nav-icon">👨‍⚕️</span>
        </button>
        <button type="button" data-target="tab-admission" data-label="Patient Admission" title="Patient Admission/Registration" class="navbtn icon-only" aria-label="Patient Admission">
          <span class="nav-icon">🏥</span>
        </button>
        <button type="button" data-target="tab-plan" data-label="Discharge Plan" title="Discharge Plan" class="navbtn icon-only" aria-label="Discharge Plan">
          <span class="nav-icon">📋</span>
        </button>
        <button type="button" data-target="tab-staff" data-label="Staff Management" title="Staff Management" class="navbtn icon-only" aria-label="Staff Management">
          <span class="nav-icon">👥</span>
        </button>
      </nav>
    </div>
  </div>

  <main class="pt-4 px-6 pb-12">
    <div class="max-w-7xl mx-auto grid grid-cols-12 gap-6">
      <!-- Sidebar -->
      <aside class="col-span-12 md:col-span-3 lg:col-span-2 sticky top-28">
        <div class="p-4 rounded-2xl glass soft-shadow">
          <nav class="flex flex-col gap-2 items-center" id="mainNav">
            <button type="button" data-target="tab-dashboard" data-label="Dashboard" title="Dashboard" class="navbtn icon-btn" aria-label="Dashboard">🏠<span class="sr-only">Dashboard</span><div class="sr-name"> Dashboard</div></button>
            <button type="button" data-target="tab-departments" data-label="Departments & Beds" title="Departments & Beds" class="navbtn icon-btn" aria-label="Departments & Beds">🏥<span class="sr-only">Departments & Beds</span><div class="sr-name"> Departments</div></button>
            <button type="button" data-target="tab-info" data-label="Patient Information" title="Patient Information" class="navbtn icon-btn" aria-label="Patient Information">👤<span class="sr-only">Patient Information</span><div class="sr-name"> Patient</div></button>
            <button type="button" data-target="tab-id" data-label="Identification" title="Identification & Insurance" class="navbtn icon-btn" aria-label="Identification & Insurance">🪪<span class="sr-only">Identification & Insurance</span><div class="sr-name"> ID</div></button>
            <button type="button" data-target="tab-history" data-label="Medical History" title="Medical History" class="navbtn icon-btn" aria-label="Medical History">📋<span class="sr-only">Medical History</span><div class="sr-name"> History</div></button>
            <button type="button" data-target="tab-physical" data-label="Physical Assessment" title="Physical Assessment" class="navbtn icon-btn" aria-label="Physical Assessment">👩‍⚕️<span class="sr-only">Physical Assessment</span><div class="sr-name"> P.A</div></button>
            <button type="button" data-target="tab-assessment" data-label="Treatment Plan" title="Treatment Plan" class="navbtn icon-btn" aria-label="Treatment Plan">📋<span class="sr-only">Treatment Plan</span><div class="sr-name"> Plan</div></button>
            <button type="button" data-target="tab-labs" data-label="Labs" title="Laboratory & Diagnostics" class="navbtn icon-btn" aria-label="Laboratory & Diagnostics">🧪<span class="sr-only">Laboratory & Diagnostics</span><div class="sr-name"> Labs</div></button>
            <button type="button" data-target="tab-meds" data-label="Medication & IV Order" title="Medication & IV Order" class="navbtn icon-btn" aria-label="Medication & IV Order">💊<span class="sr-only">Medication & IV Order</span><div class="sr-name"> Meds</div></button>
            <button type="button" data-target="tab-messages" data-label="Messages" title="Clinical Messages & Alerts" class="navbtn icon-btn" aria-label="Clinical Messages & Alerts">💬<span class="sr-only">Clinical Messages & Alerts</span><div class="sr-name"> Messages</div></button>
            <button type="button" data-target="tab-vitals" data-label="Vitals" title="Vitals & Monitoring" class="navbtn icon-btn" aria-label="Vitals & Monitoring">❤️<span class="sr-only">Vitals & Monitoring</span><div class="sr-name"> Vitals</div></button>
            <button type="button" data-target="tab-nurse" data-label="Nurse Notes" title="Nurse Notes (FDAR)" class="navbtn icon-btn" aria-label="Nurse Notes">👩‍⚕️<span class="sr-only">Nurse Notes (FDAR)</span><div class="sr-name"> Nurse</div></button>
            <button type="button" data-target="tab-doctor" data-label="Doctor Notes" title="Doctor Notes" class="navbtn icon-btn" aria-label="Doctor Notes">👨‍⚕️<span class="sr-only">Doctor Notes</span><div class="sr-name"> Doctor</div></button>
            <button type="button" data-target="tab-admission" data-label="Patient Admission" title="Patient Admission/Registration" class="navbtn icon-btn" aria-label="Patient Admission">🏥<span class="sr-only">Patient Admission/Registration</span><div class="sr-name"> Admission</div></button>
            <button type="button" data-target="tab-plan" data-label="Discharge Plan" title="Discharge Plan" class="navbtn icon-btn" aria-label="Discharge Plan">📑<span class="sr-only">Discharge Plan</span><div class="sr-name"> Plan</div></button>
            <button type="button" data-target="tab-staff" data-label="Staff Management" title="Staff Management" class="navbtn icon-btn" aria-label="Staff Management">👥<span class="sr-only">Staff Management</span><div class="sr-name"> Staff</div></button>
          </nav>
        </div>
      </aside>

      <!-- Content area -->
      <section class="col-span-12 md:col-span-9 lg:col-span-10 space-y-6">
        <!-- Begin full tab forms (copied from your original file and restyled) -->

        <!-- 0 • Dashboard -->
        <div id="tab-dashboard" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <!-- Dashboard Header -->
          <div class="dashboard-header p-6 rounded-2xl glass soft-shadow mb-6">
            <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4">
              <div class="dashboard-title-section">
                <h1 class="text-3xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">
                  Dashboard
                </h1>
                <p class="text-sm text-slate-500 mt-1">Real-time healthcare overview & quick actions</p>
                <div class="flex items-center gap-2 mt-2">
                  <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
                  <span class="text-xs text-emerald-600 font-medium">Live Updates</span>
                  <span class="text-xs text-slate-400" id="lastUpdated">Updated just now</span>
                </div>
              </div>
              <div class="dashboard-controls flex flex-col sm:flex-row items-start sm:items-center gap-4">
                <div class="stats-badge">
                  <span class="text-sm text-slate-600">Total Records</span>
                  <span id="count" class="text-2xl font-bold text-emerald-600">0</span>
                </div>
                <div class="flex gap-2">
                  <select id="sortSelect" class="modern-select px-4 py-2 rounded-xl border-2 border-emerald-100 bg-white focus:border-emerald-300 focus:ring-4 focus:ring-emerald-50 transition-all">
                    <option value="updatedAt_desc">📅 Recent First</option>
                    <option value="name_asc">🔤 Name A-Z</option>
                    <option value="admissionDate_desc">🏥 By Admission</option>
                    <option value="status_asc">📊 By Status</option>
                  </select>
                  <button id="refreshDashboard" class="px-4 py-2 rounded-xl border-2 border-emerald-100 bg-white hover:bg-emerald-50 transition-all" title="Refresh Dashboard">
                    🔄
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Enhanced Dashboard Overview -->
          <div class="dashboard-overview mb-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <!-- Quick Stats Panel -->
              <div class="stats-panel bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-2xl border border-blue-100">
                <h2 class="text-lg font-bold text-blue-900 mb-4 flex items-center gap-2">
                  📊 Quick Statistics
                </h2>
                <div class="grid grid-cols-2 gap-4">
                  <div class="stat-item text-center">
                    <div class="text-2xl font-bold text-blue-600" id="totalPatients">0</div>
                    <div class="text-xs text-blue-500">Total Patients</div>
                  </div>
                  <div class="stat-item text-center">
                    <div class="text-2xl font-bold text-green-600" id="activePatients">0</div>
                    <div class="text-xs text-green-500">Active Cases</div>
                  </div>
                  <div class="stat-item text-center">
                    <div class="text-2xl font-bold text-orange-600" id="pendingTasks">0</div>
                    <div class="text-xs text-orange-500">Pending Tasks</div>
                  </div>
                  <div class="stat-item text-center">
                    <div class="text-2xl font-bold text-purple-600" id="criticalAlerts">0</div>
                    <div class="text-xs text-purple-500">Critical Alerts</div>
                  </div>
                </div>
              </div>
              
              <!-- Quick Actions Panel -->
              <div class="actions-panel bg-gradient-to-br from-emerald-50 to-teal-50 p-6 rounded-2xl border border-emerald-100">
                <h2 class="text-lg font-bold text-emerald-900 mb-4 flex items-center gap-2">
                  ⚡ Quick Actions
                </h2>
                <div class="space-y-3">
                  <button class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2" onclick="window.location.hash='#tab-vitals'">
                    🌡️ Record Vitals
                  </button>
                  <button class="w-full px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center gap-2" onclick="window.location.hash='#tab-meds'">
                    💊 Medication Order
                  </button>
                  <button class="w-full px-4 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors flex items-center justify-center gap-2" onclick="window.location.hash='#tab-labs'">
                    🧪 Lab Results
                  </button>
                </div>
              </div>
              
              <!-- System Status Panel -->
              <div class="system-panel bg-gradient-to-br from-slate-50 to-gray-50 p-6 rounded-2xl border border-slate-200">
                <h2 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
                  🖥️ System Status
                </h2>
                <div class="space-y-3">
                  <div class="flex justify-between items-center">
                    <span class="text-sm text-slate-600">Database</span>
                    <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Connected</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-sm text-slate-600">Backup Status</span>
                    <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Up to Date</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-sm text-slate-600">Last Sync</span>
                    <span class="text-xs text-slate-500" id="lastSyncTime">Just now</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-sm text-slate-600">Storage</span>
                    <span class="text-xs text-slate-500">85% Available</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Modern Dashboard Cards -->
          <div class="dashboard-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
              <!-- Patient Census Card -->
              <div class="dashboard-card modern-card-mint group cursor-pointer" onclick="showAllPatients()">
                <div class="card-header">
                  <div class="card-icon mint-icon">
                    <span class="text-2xl">👥</span>
                  </div>
                  <div class="card-badge">Live</div>
                </div>
                <div class="card-content">
                  <h3 class="card-title">Patient Census</h3>
                  <div class="card-value" id="totalPatientsCard">0</div>
                  <div class="card-stats">
                    <span class="stat-item">
                      <span class="stat-dot bg-emerald-400"></span>
                      <span id="inPatients">0</span> Inpatient
                    </span>
                    <span class="stat-item">
                      <span class="stat-dot bg-teal-400"></span>
                      <span id="outPatients">0</span> Outpatient
                    </span>
                  </div>
                  <div class="card-subtitle text-xs mt-2 opacity-70">Click to view all patients</div>
                </div>
              </div>

              <!-- Vitals Monitoring Card -->
              <div class="dashboard-card modern-card-teal group cursor-pointer" onclick="navigateToTab('tab-vitals')">
                <div class="card-header">
                  <div class="card-icon teal-icon">
                    <span class="text-2xl">📊</span>
                  </div>
                  <div class="card-badge">24h</div>
                </div>
                <div class="card-content">
                  <h3 class="card-title">Vitals Monitor</h3>
                  <div class="card-value" id="vitalsSpark">—</div>
                  <div class="card-chart">
                    <svg id="vitalsSparkline" viewBox="0 0 100 24" preserveAspectRatio="none" class="w-full h-full">
                      <defs>
                        <linearGradient id="vitalsGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                          <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.8" />
                          <stop offset="100%" style="stop-color:#10b981;stop-opacity:0.1" />
                        </linearGradient>
                      </defs>
                      <path d="M 0,12 Q 25,4 50,12 T 100,8" stroke="url(#vitalsGradient)" fill="none" stroke-width="2"/>
                    </svg>
                  </div>
                  <div class="card-subtitle text-xs mt-2 opacity-70">Click to manage vitals</div>
                </div>
              </div>

              <!-- Medications Card -->
              <div class="dashboard-card modern-card-green group cursor-pointer" onclick="navigateToTab('tab-meds')">
                <div class="card-header">
                  <div class="card-icon green-icon">
                    <span class="text-2xl">💊</span>
                  </div>
                  <div class="card-badge">Today</div>
                </div>
                <div class="card-content">
                  <h3 class="card-title">Medications</h3>
                  <div class="card-value" id="medsCount">0</div>
                  <div class="card-subtitle">Administered in last 24h</div>
                  <div class="card-stats mt-2">
                    <span class="stat-item">
                      <span class="stat-dot bg-green-400"></span>
                      <span id="pendingMeds">0</span> Pending
                    </span>
                    <span class="stat-item">
                      <span class="stat-dot bg-amber-400"></span>
                      <span id="dueMeds">0</span> Due Now
                    </span>
                  </div>
                  <div class="card-subtitle text-xs mt-2 opacity-70">Click to manage medications</div>
                </div>
              </div>

              <!-- Quick Actions Card -->
              <div class="dashboard-card modern-card-mint group">
                <div class="card-header">
                  <div class="card-icon mint-icon">
                    <span class="text-2xl">⚡</span>
                  </div>
                  <div class="card-badge">Actions</div>
                </div>
                <div class="card-content">
                  <h3 class="card-title">Quick Actions</h3>
                  <div class="space-y-2 mt-4">
                    <button onclick="navigateToTab('tab-vitals')" class="w-full text-left px-3 py-2 rounded-lg bg-teal-50 hover:bg-teal-100 transition-colors text-sm">
                      ❤️ Record Vitals
                    </button>
                    <button onclick="navigateToTab('tab-nurse')" class="w-full text-left px-3 py-2 rounded-lg bg-green-50 hover:bg-green-100 transition-colors text-sm">
                      📝 Nurse Notes
                    </button>
                  </div>
                </div>
              </div>

              <!-- Alerts & Notifications Card -->
              <div class="dashboard-card modern-card-teal group">
                <div class="card-header">
                  <div class="card-icon teal-icon">
                    <span class="text-2xl">🔔</span>
                  </div>
                  <div class="card-badge" id="alertCount">0</div>
                </div>
                <div class="card-content">
                  <h3 class="card-title">Alerts & Tasks</h3>
                  <div id="alertsList" class="space-y-2 mt-4 max-h-32 overflow-y-auto">
                    <div class="text-sm text-slate-400 italic">No active alerts</div>
                  </div>
                </div>
              </div>

              <!-- System Status Card -->
              <div class="dashboard-card modern-card-green group">
                <div class="card-header">
                  <div class="card-icon green-icon">
                    <span class="text-2xl">⚡</span>
                  </div>
                  <div class="card-badge" id="systemStatus">Online</div>
                </div>
                <div class="card-content">
                  <h3 class="card-title">System Status</h3>
                  <div class="space-y-2 mt-4 text-sm">
                    <div class="flex justify-between">
                      <span>Database</span>
                      <span class="text-emerald-600" id="dbStatus">● Connected</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Last Backup</span>
                      <span class="text-slate-500" id="lastBackup">2 hours ago</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Active Users</span>
                      <span class="text-slate-500" id="activeUsers">1</span>
                    </div>
                  </div>
                </div>
              </div>
          </div>

          <!-- Modern Timeline Section -->
          <div class="timeline-section p-6 rounded-2xl glass soft-shadow mb-6">
            <div class="timeline-header flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-6">
              <div>
                <h3 class="text-xl font-bold text-emerald-700">Patient Activity Timeline</h3>
                <p class="text-sm text-slate-500 mt-1">Real-time events and care activities</p>
              </div>
              <div class="timeline-controls flex flex-wrap items-center gap-3">
                <button class="timeline-filter-btn active" data-filter="all">All</button>
                <button class="timeline-filter-btn" data-filter="vitals">Vitals</button>
                <button class="timeline-filter-btn" data-filter="meds">Meds</button>
                <button class="timeline-filter-btn" data-filter="notes">Notes</button>
                <button class="timeline-filter-btn" data-filter="labs">Labs</button>
                <select id="timelinePatientFilter" class="px-3 py-1 rounded-lg border text-sm">
                  <option value="">All Patients</option>
                </select>
              </div>
            </div>
            
            <div class="modern-timeline-track" id="timelineTrack">
              <!-- events are positioned via JS -->
              <div class="timeline-placeholder" id="timelinePlaceholder">
                <div class="placeholder-icon">⏱️</div>
                <p class="text-slate-400">Select a patient to view activity timeline</p>
              </div>
              <!-- Timeline events will be inserted here -->
              <div id="timelineEvents" class="relative min-h-[80px] hidden"></div>
            </div>
            
            <div class="modern-timeline-legend">
              <div class="legend-item">
                <span class="legend-dot bg-emerald-400"></span>
                <span>Admission</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot bg-teal-400"></span>
                <span>Medications</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot bg-green-400"></span>
                <span>Vitals</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot bg-mint-400"></span>
                <span>Notes</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot bg-blue-400"></span>
                <span>Labs</span>
              </div>
              <div class="legend-item">
                <span class="legend-dot bg-purple-400"></span>
                <span>Procedures</span>
              </div>
            </div>
          </div>

          <!-- Modern Patients Grid -->
          <div class="patients-section">
            <div class="section-header p-6 rounded-2xl glass soft-shadow mb-6">
              <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4">
                <div>
                  <h3 class="text-xl font-bold text-emerald-700">Active Patients</h3>
                  <p class="text-sm text-slate-500 mt-1">Currently under care</p>
                </div>
                <div class="flex flex-col sm:flex-row gap-3">
                  <div class="relative">
                    <input 
                      type="text" 
                      id="patientSearch" 
                      placeholder="Search patients..." 
                      class="pl-10 pr-4 py-2 rounded-lg border-2 border-emerald-100 focus:border-emerald-300 focus:ring-4 focus:ring-emerald-50 transition-all"
                    >
                    <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400">
                      🔍
                    </div>
                  </div>
                  <select id="patientStatusFilter" class="px-4 py-2 rounded-lg border-2 border-emerald-100 focus:border-emerald-300 transition-all">
                    <option value="">All Status</option>
                    <option value="Inpatient">Inpatient</option>
                    <option value="Outpatient">Outpatient</option>
                    <option value="Emergency">Emergency</option>
                    <option value="Observation">Observation</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- Loading State -->
            <div id="patientsLoading" class="hidden text-center py-12">
              <div class="inline-block w-8 h-8 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin"></div>
              <p class="text-slate-500 mt-4">Loading patients...</p>
            </div>
            
            <!-- Empty State -->
            <div id="patientsEmpty" class="hidden text-center py-12">
              <div class="text-6xl mb-4">👥</div>
              <h3 class="text-xl font-semibold text-slate-700 mb-2">No Patients Found</h3>
              <p class="text-slate-500 mb-6">Start by adding your first patient to the system.</p>
            </div>
            
            <!-- Patients Grid -->
            <div id="patientsContainer" class="modern-patients-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            
            <!-- Pagination -->
            <div id="patientsPagination" class="hidden mt-8 flex justify-center items-center gap-4">
              <button id="prevPage" class="px-4 py-2 border rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                ← Previous
              </button>
              <span id="pageInfo" class="text-sm text-slate-600"></span>
              <button id="nextPage" class="px-4 py-2 border rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                Next →
              </button>
            </div>
          </div>
        </div>

        <!-- Departments & Bed Management -->
        <div id="tab-departments" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                Departments & Bed Management
              </h3>
              <p class="text-sm text-slate-500 mt-1">Manage hospital departments, bed assignments, and patient flow</p>
            </div>
            <div class="flex items-center gap-2">
              <select id="departmentFilter" class="px-3 py-2 rounded-lg border text-sm">
                <option value="">All Departments</option>
                <option value="emergency">Emergency</option>
                <option value="icu">ICU</option>
                <option value="general-ward">General Ward</option>
                <option value="surgery">Surgery</option>
                <option value="pediatrics">Pediatrics</option>
                <option value="maternity">Maternity</option>
              </select>
              <button id="refreshDepartments" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                🔄 Refresh
              </button>
            </div>
          </div>
          
          <!-- Department Statistics -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="stat-card bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-xl border border-blue-200">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-2xl font-bold text-blue-600" id="totalBeds">0</div>
                  <div class="text-sm text-blue-500">Total Beds</div>
                </div>
                <div class="text-3xl text-blue-400">🛏️</div>
              </div>
            </div>
            <div class="stat-card bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-xl border border-green-200">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-2xl font-bold text-green-600" id="availableBeds">0</div>
                  <div class="text-sm text-green-500">Available</div>
                </div>
                <div class="text-3xl text-green-400">✅</div>
              </div>
            </div>
            <div class="stat-card bg-gradient-to-br from-red-50 to-rose-50 p-4 rounded-xl border border-red-200">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-2xl font-bold text-red-600" id="occupiedBeds">0</div>
                  <div class="text-sm text-red-500">Occupied</div>
                </div>
                <div class="text-3xl text-red-400">👥</div>
              </div>
            </div>
            <div class="stat-card bg-gradient-to-br from-yellow-50 to-amber-50 p-4 rounded-xl border border-yellow-200">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-2xl font-bold text-yellow-600" id="occupancyRate">0%</div>
                  <div class="text-sm text-yellow-500">Occupancy Rate</div>
                </div>
                <div class="text-3xl text-yellow-400">📊</div>
              </div>
            </div>
          </div>
          
          <!-- Departments Grid -->
          <div class="departments-section mb-6">
            <h4 class="text-xl font-bold text-slate-800 mb-4">Hospital Departments</h4>
            <div id="departmentsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
              <!-- Departments will be rendered here -->
            </div>
          </div>
          
          <!-- Quick Actions -->
          <div class="quick-actions bg-gradient-to-br from-slate-50 to-gray-50 p-6 rounded-xl border border-slate-200">
            <h4 class="text-lg font-bold text-slate-800 mb-4">Quick Actions</h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <button onclick="showBedAssignmentModal()" class="flex items-center gap-3 p-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                <span class="text-xl">🛏️</span>
                <div class="text-left">
                  <div class="font-semibold">Assign Patient to Bed</div>
                  <div class="text-xs opacity-80">Manage bed assignments</div>
                </div>
              </button>
              
              <button onclick="showPatientTransferModal()" class="flex items-center gap-3 p-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                <span class="text-xl">🔄</span>
                <div class="text-left">
                  <div class="font-semibold">Transfer Patient</div>
                  <div class="text-xs opacity-80">Move between departments</div>
                </div>
              </button>
              
              <button onclick="showBedMaintenanceModal()" class="flex items-center gap-3 p-4 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors">
                <span class="text-xl">🔧</span>
                <div class="text-left">
                  <div class="font-semibold">Bed Maintenance</div>
                  <div class="text-xs opacity-80">Mark beds for cleaning</div>
                </div>
              </button>
            </div>
          </div>
        </div>

        <!-- 1 • Patient Information -->
        <div id="tab-info" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-2xl font-bold text-slate-800">1 • Patient Information</h3>
              <p class="text-sm text-slate-500 mt-1">Complete patient demographics and admission details</p>
            </div>
            <div class="flex gap-2">
              <button type="button" id="autoFillDemo" class="px-3 py-1 text-xs bg-slate-100 text-slate-600 rounded hover:bg-slate-200 transition-colors">
                Demo Data
              </button>
              <button type="button" id="clearInfo" class="px-3 py-1 text-xs bg-slate-100 text-slate-600 rounded hover:bg-slate-200 transition-colors">
                Clear All
              </button>
            </div>
          </div>
          
          <!-- Patient Information Form Progress -->
          <div class="form-progress mb-6">
            <div class="flex items-center justify-between text-sm text-slate-600">
              <span>Form Completion</span>
              <span id="infoProgress">0% Complete</span>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-2 mt-2">
              <div id="infoProgressBar" class="bg-gradient-to-r from-emerald-400 to-emerald-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
          </div>

          <form id="form-info" class="space-y-6">
            <!-- Hospital Information Section -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 shadow-sm">
              <h4 class="font-bold text-blue-800 mb-4 flex items-center gap-2">
                🏥 Hospital Information
                <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">Required</span>
              </h4>
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="form-group">
                  <label for="info_mrn" class="block text-sm font-semibold text-slate-700 mb-2">
                    Medical Record No. (MRN) *
                  </label>
                  <input 
                    id="info_mrn" 
                    name="mrn" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" 
                    placeholder="Enter MRN"
                    required 
                  />
                  <div class="text-xs text-slate-500 mt-1 flex items-center gap-1">
                    <span class="w-1 h-1 bg-slate-400 rounded-full"></span>
                    System will auto-generate if empty
                  </div>
                </div>
                <div class="form-group">
                  <label for="info_patientStatus" class="block text-sm font-semibold text-slate-700 mb-2">
                    Patient Class *
                  </label>
                  <select id="info_patientStatus" name="patientStatus" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" required>
                    <option value="">Select Patient Class</option>
                    <option value="Outpatient">🚶 Outpatient</option>
                    <option value="Inpatient">🛏️ Inpatient</option>
                    <option value="Emergency">🚨 Emergency</option>
                    <option value="Observation">👀 Observation</option>
                    <option value="Day Surgery">🔬 Day Surgery</option>
                    <option value="ICU">🏥 ICU</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="info_department" class="block text-sm font-semibold text-slate-700 mb-2">
                    Department *
                  </label>
                  <select id="info_department" name="departmentId" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" required>
                    <option value="">Select Department</option>
                    <option value="emergency">🚨 Emergency Department</option>
                    <option value="icu">🏥 Intensive Care Unit</option>
                    <option value="general-ward">🛏️ General Ward</option>
                    <option value="surgery">⚕️ Surgery Department</option>
                    <option value="pediatrics">👶 Pediatrics</option>
                    <option value="maternity">🤱 Maternity Ward</option>
                    <option value="cardiology">❤️ Cardiology</option>
                    <option value="orthopedics">🦴 Orthopedics</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="info_bedAssignment" class="block text-sm font-semibold text-slate-700 mb-2">
                    Bed Assignment
                  </label>
                  <select id="info_bedAssignment" name="bedId" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all">
                    <option value="">No bed assigned</option>
                    <!-- Beds will be populated dynamically -->
                  </select>
                  <div class="text-xs text-slate-500 mt-1">Select department first</div>
                </div>
                <div class="form-group">
                  <label for="info_roomNo" class="block text-sm font-semibold text-slate-700 mb-2">Room No.</label>
                  <input id="info_roomNo" name="roomNo" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" placeholder="e.g., 201A" />
                </div>
                <div class="form-group">
                  <label for="info_bedNo" class="block text-sm font-semibold text-slate-700 mb-2">Bed No.</label>
                  <input id="info_bedNo" name="bedNo" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" placeholder="e.g., 1, 2, A" />
                </div>
              </div>
            </div>

            <!-- Admission Details Section -->
            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
              <h4 class="font-semibold text-green-800 mb-3">📅 Admission Details</h4>
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                  <label for="info_admissionDate" class="block text-sm font-semibold text-slate-700 mb-1">
                    Admission Date *
                  </label>
                  <input 
                    id="info_admissionDate" 
                    name="admissionDate" 
                    type="date" 
                    class="w-full rounded-lg px-3 py-2 border focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                    required 
                  />
                </div>
                <div>
                  <label for="info_admissionTime" class="block text-sm font-semibold text-slate-700 mb-1">
                    Admission Time *
                  </label>
                  <input 
                    id="info_admissionTime" 
                    name="admissionTime" 
                    type="time" 
                    class="w-full rounded-lg px-3 py-2 border focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                    required 
                  />
                </div>
                <div>
                  <label for="info_physician" class="block text-sm font-semibold text-slate-700 mb-1">
                    Attending Physician *
                  </label>
                  <input 
                    id="info_physician" 
                    name="physician" 
                    class="w-full rounded-lg px-3 py-2 border focus:ring-2 focus:ring-green-500 focus:border-green-500" 
                    placeholder="Dr. [Name]" 
                    required 
                  />
                </div>
                <div>
                  <label for="info_referralSource" class="block text-sm font-semibold text-slate-700 mb-1">Referral Source</label>
                  <input id="info_referralSource" name="referralSource" class="w-full rounded-lg px-3 py-2 border focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="Clinic/Hospital" />
                </div>
              </div>
            </div>

            <!-- Personal Information Section -->
            <div class="bg-gradient-to-br from-purple-50 to-violet-50 p-6 rounded-xl border border-purple-200 shadow-sm">
              <h4 class="font-bold text-purple-800 mb-4 flex items-center gap-2">
                👤 Personal Information
                <span class="px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full">Required</span>
              </h4>
              
              <!-- Name Fields -->
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                <div class="form-group">
                  <label for="info_firstName" class="block text-sm font-semibold text-slate-700 mb-2">
                    First Name *
                  </label>
                  <input 
                    id="info_firstName" 
                    name="firstName" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" 
                    placeholder="Enter first name" 
                    pattern="[A-Za-z\s]{1,50}"
                    title="First name should contain only letters and spaces (max 50 characters)"
                    required 
                  />
                </div>
                <div class="form-group">
                  <label for="info_middleName" class="block text-sm font-semibold text-slate-700 mb-2">
                    Middle Name
                  </label>
                  <input 
                    id="info_middleName" 
                    name="middleName" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" 
                    placeholder="Enter middle name" 
                    pattern="[A-Za-z\s]{0,50}"
                    title="Middle name should contain only letters and spaces (max 50 characters)"
                  />
                </div>
                <div class="form-group">
                  <label for="info_lastName" class="block text-sm font-semibold text-slate-700 mb-2">
                    Last Name *
                  </label>
                  <input 
                    id="info_lastName" 
                    name="lastName" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" 
                    placeholder="Enter last name" 
                    pattern="[A-Za-z\s]{1,50}"
                    title="Last name should contain only letters and spaces (max 50 characters)"
                    required 
                  />
                </div>
              </div>

              <!-- Additional Name Information -->
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <div class="form-group">
                  <label for="info_suffix" class="block text-sm font-semibold text-slate-700 mb-2">
                    Suffix
                  </label>
                  <select id="info_suffix" name="suffix" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all">
                    <option value="">Select Suffix</option>
                    <option value="Jr.">Jr.</option>
                    <option value="Sr.">Sr.</option>
                    <option value="II">II</option>
                    <option value="III">III</option>
                    <option value="IV">IV</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="info_preferredName" class="block text-sm font-semibold text-slate-700 mb-2">
                    Preferred Name
                  </label>
                  <input 
                    id="info_preferredName" 
                    name="preferredName" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" 
                    placeholder="Nickname or preferred name" 
                  />
                </div>
                <div class="form-group">
                  <label for="info_title" class="block text-sm font-semibold text-slate-700 mb-2">
                    Title
                  </label>
                  <select id="info_title" name="title" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all">
                    <option value="">Select Title</option>
                    <option value="Mr.">Mr.</option>
                    <option value="Ms.">Ms.</option>
                    <option value="Mrs.">Mrs.</option>
                    <option value="Dr.">Dr.</option>
                    <option value="Prof.">Prof.</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="info_maidenName" class="block text-sm font-semibold text-slate-700 mb-2">
                    Maiden Name
                  </label>
                  <input 
                    id="info_maidenName" 
                    name="maidenName" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" 
                    placeholder="Maiden name (if applicable)" 
                  />
                </div>
              </div>

              <!-- Status and Demographics -->
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="info_civilStatus" class="block text-sm font-semibold text-slate-700 mb-2">
                    Civil Status *
                  </label>
                  <select id="info_civilStatus" name="civilStatus" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" required>
                    <option value="">Select Civil Status</option>
                    <option value="Single">💍 Single</option>
                    <option value="Married">👫 Married</option>
                    <option value="Widowed">🕯️ Widowed</option>
                    <option value="Divorced">📄 Divorced</option>
                    <option value="Separated">↔️ Separated</option>
                    <option value="Common Law">🤝 Common Law</option>
                    <option value="Other">❓ Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="info_dob" class="block text-sm font-semibold text-slate-700 mb-2">
                    Date of Birth *
                  </label>
                  <div class="relative">
                    <input 
                      id="info_dob" 
                      name="dob" 
                      type="date" 
                      class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" 
                      max=""
                      required 
                    />
                    <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                      📅
                    </div>
                  </div>
                  <div class="text-xs text-slate-500 mt-1">Must be a valid past date</div>
                </div>
              </div>

              <!-- Age and Gender Information -->
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="form-group">
                  <label for="info_age" class="block text-sm font-semibold text-slate-700 mb-2">
                    Age
                  </label>
                  <div class="relative">
                    <input 
                      id="info_age" 
                      name="age" 
                      type="number" 
                      class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 bg-slate-50 transition-all" 
                      readonly 
                      placeholder="Auto-calculated"
                    />
                    <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400">
                      🎂
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label for="info_gender" class="block text-sm font-semibold text-slate-700 mb-2">
                    Sex *
                  </label>
                  <select id="info_gender" name="gender" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" required>
                    <option value="">Select Sex</option>
                    <option value="Male">♂️ Male</option>
                    <option value="Female">♀️ Female</option>
                    <option value="Other">⚧️ Other</option>
                    <option value="Prefer not to say">🤐 Prefer not to say</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="info_genderIdentity" class="block text-sm font-semibold text-slate-700 mb-2">
                    Gender Identity
                  </label>
                  <select id="info_genderIdentity" name="genderIdentity" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all">
                    <option value="">Select Identity</option>
                    <option value="Cisgender">Cisgender</option>
                    <option value="Transgender">Transgender</option>
                    <option value="Non-binary">Non-binary</option>
                    <option value="Gender fluid">Gender fluid</option>
                    <option value="Other">Other</option>
                    <option value="Prefer not to say">Prefer not to say</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="info_pronouns" class="block text-sm font-semibold text-slate-700 mb-2">
                    Pronouns
                  </label>
                  <select id="info_pronouns" name="pronouns" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all">
                    <option value="">Select Pronouns</option>
                    <option value="He/Him">He/Him</option>
                    <option value="She/Her">She/Her</option>
                    <option value="They/Them">They/Them</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
              </div>

            </div>

            <!-- Contact Information Section -->
            <div class="bg-gradient-to-br from-teal-50 to-cyan-50 p-6 rounded-xl border border-teal-200 shadow-sm">
              <h4 class="font-bold text-teal-800 mb-4 flex items-center gap-2">
                📞 Contact Information
                <span class="px-2 py-1 bg-teal-100 text-teal-700 text-xs rounded-full">Required</span>
              </h4>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="form-group">
                  <label for="info_contact" class="block text-sm font-semibold text-slate-700 mb-2">
                    Primary Phone *
                  </label>
                  <input 
                    id="info_contact" 
                    name="contact" 
                    type="tel" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-teal-100 focus:border-teal-500 transition-all" 
                    placeholder="+63 XXX XXX XXXX"
                    pattern="[+]?[\d\s\-()]{10,15}"
                    title="Please enter a valid phone number"
                    required 
                  />
                </div>
                <div class="form-group">
                  <label for="info_contactSecondary" class="block text-sm font-semibold text-slate-700 mb-2">
                    Secondary Phone
                  </label>
                  <input 
                    id="info_contactSecondary" 
                    name="contactSecondary" 
                    type="tel" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-teal-100 focus:border-teal-500 transition-all" 
                    placeholder="+63 XXX XXX XXXX"
                    pattern="[+]?[\d\s\-()]{10,15}"
                    title="Please enter a valid phone number"
                  />
                </div>
                <div class="form-group">
                  <label for="info_email" class="block text-sm font-semibold text-slate-700 mb-2">
                    Email Address
                  </label>
                  <input 
                    id="info_email" 
                    name="email" 
                    type="email" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-teal-100 focus:border-teal-500 transition-all" 
                    placeholder="patient@example.com"
                    title="Please enter a valid email address"
                  />
                </div>
              </div>
              
              <!-- Emergency Contact -->
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4 p-4 bg-red-50 rounded-lg border border-red-200">
                <div class="sm:col-span-2">
                  <h5 class="font-semibold text-red-800 mb-3 flex items-center gap-2">
                    🚨 Emergency Contact
                  </h5>
                </div>
                <div class="form-group">
                  <label for="info_emergencyName" class="block text-sm font-semibold text-slate-700 mb-2">
                    Contact Name *
                  </label>
                  <input 
                    id="info_emergencyName" 
                    name="emergencyName" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-red-100 focus:border-red-500 transition-all" 
                    placeholder="Full name"
                    required 
                  />
                </div>
                <div class="form-group">
                  <label for="info_emergencyPhone" class="block text-sm font-semibold text-slate-700 mb-2">
                    Phone Number *
                  </label>
                  <input 
                    id="info_emergencyPhone" 
                    name="emergencyPhone" 
                    type="tel" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-red-100 focus:border-red-500 transition-all" 
                    placeholder="+63 XXX XXX XXXX"
                    pattern="[+]?[\d\s\-()]{10,15}"
                    title="Please enter a valid phone number"
                    required 
                  />
                </div>
                <div class="form-group">
                  <label for="info_emergencyRelation" class="block text-sm font-semibold text-slate-700 mb-2">
                    Relationship
                  </label>
                  <select id="info_emergencyRelation" name="emergencyRelation" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-red-100 focus:border-red-500 transition-all">
                    <option value="">Select Relationship</option>
                    <option value="Spouse">👫 Spouse</option>
                    <option value="Parent">👨‍👩‍👦 Parent</option>
                    <option value="Child">👶 Child</option>
                    <option value="Sibling">👫 Sibling</option>
                    <option value="Friend">👥 Friend</option>
                    <option value="Guardian">🛡️ Guardian</option>
                    <option value="Other">❓ Other</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Address Information Section -->
            <div class="bg-gradient-to-br from-amber-50 to-orange-50 p-6 rounded-xl border border-amber-200 shadow-sm">
              <h4 class="font-bold text-amber-800 mb-4 flex items-center gap-2">
                🏠 Address Information
                <span class="px-2 py-1 bg-amber-100 text-amber-700 text-xs rounded-full">Required</span>
              </h4>
              
              <div class="grid grid-cols-1 gap-4 mb-4">
                <div class="form-group">
                  <label for="info_address" class="block text-sm font-semibold text-slate-700 mb-2">
                    Street Address *
                  </label>
                  <input 
                    id="info_address" 
                    name="address" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-amber-100 focus:border-amber-500 transition-all" 
                    placeholder="House/Unit number, Street name"
                    required 
                  />
                </div>
              </div>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="form-group">
                  <label for="info_city" class="block text-sm font-semibold text-slate-700 mb-2">
                    City/Municipality *
                  </label>
                  <input 
                    id="info_city" 
                    name="city" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-amber-100 focus:border-amber-500 transition-all" 
                    placeholder="City or Municipality"
                    required 
                  />
                </div>
                <div class="form-group">
                  <label for="info_province" class="block text-sm font-semibold text-slate-700 mb-2">
                    Province/State *
                  </label>
                  <input 
                    id="info_province" 
                    name="province" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-amber-100 focus:border-amber-500 transition-all" 
                    placeholder="Province or State"
                    required 
                  />
                </div>
                <div class="form-group">
                  <label for="info_zipCode" class="block text-sm font-semibold text-slate-700 mb-2">
                    ZIP/Postal Code
                  </label>
                  <input 
                    id="info_zipCode" 
                    name="zipCode" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-amber-100 focus:border-amber-500 transition-all" 
                    placeholder="ZIP/Postal Code"
                    pattern="[\d\-]{4,10}"
                    title="Please enter a valid postal code"
                  />
                </div>
                <div class="form-group">
                  <label for="info_country" class="block text-sm font-semibold text-slate-700 mb-2">
                    Country *
                  </label>
                  <select id="info_country" name="country" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-amber-100 focus:border-amber-500 transition-all" required>
                    <option value="">Select Country</option>
                    <option value="Philippines">🇵🇭 Philippines</option>
                    <option value="United States">🇺🇸 United States</option>
                    <option value="Canada">🇨🇦 Canada</option>
                    <option value="Australia">🇦🇺 Australia</option>
                    <option value="United Kingdom">🇬🇧 United Kingdom</option>
                    <option value="Other">🌍 Other</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Demographics & Cultural Information Section -->
            <div class="bg-gradient-to-br from-indigo-50 to-purple-50 p-6 rounded-xl border border-indigo-200 shadow-sm">
              <h4 class="font-bold text-indigo-800 mb-4 flex items-center gap-2">
                🌍 Demographics & Cultural Information
              </h4>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="form-group">
                  <label for="info_language" class="block text-sm font-semibold text-slate-700 mb-2">
                    Primary Language *
                  </label>
                  <select id="info_language" name="primaryLanguage" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all" required>
                    <option value="">Select Language</option>
                    <option value="English">🇺🇸 English</option>
                    <option value="Filipino">🇵🇭 Filipino</option>
                    <option value="Tagalog">🇵🇭 Tagalog</option>
                    <option value="Cebuano">🇵🇭 Cebuano</option>
                    <option value="Ilocano">🇵🇭 Ilocano</option>
                    <option value="Spanish">🇪🇸 Spanish</option>
                    <option value="Chinese">🇨🇳 Chinese</option>
                    <option value="Other">🌍 Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="info_secondaryLanguage" class="block text-sm font-semibold text-slate-700 mb-2">
                    Secondary Language
                  </label>
                  <select id="info_secondaryLanguage" name="secondaryLanguage" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all">
                    <option value="">Select Language</option>
                    <option value="English">🇺🇸 English</option>
                    <option value="Filipino">🇵🇭 Filipino</option>
                    <option value="Tagalog">🇵🇭 Tagalog</option>
                    <option value="Cebuano">🇵🇭 Cebuano</option>
                    <option value="Ilocano">🇵🇭 Ilocano</option>
                    <option value="Spanish">🇪🇸 Spanish</option>
                    <option value="Chinese">🇨🇳 Chinese</option>
                    <option value="Other">🌍 Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="info_ethnicity" class="block text-sm font-semibold text-slate-700 mb-2">
                    Ethnicity
                  </label>
                  <select id="info_ethnicity" name="ethnicity" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all">
                    <option value="">Select Ethnicity</option>
                    <option value="Filipino">🇵🇭 Filipino</option>
                    <option value="Chinese">🇨🇳 Chinese</option>
                    <option value="Spanish">🇪🇸 Spanish</option>
                    <option value="American">🇺🇸 American</option>
                    <option value="Japanese">🇯🇵 Japanese</option>
                    <option value="Korean">🇰🇷 Korean</option>
                    <option value="Indian">🇮🇳 Indian</option>
                    <option value="Mixed">🌍 Mixed</option>
                    <option value="Other">❓ Other</option>
                    <option value="Prefer not to say">🤐 Prefer not to say</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="info_religion" class="block text-sm font-semibold text-slate-700 mb-2">
                    Religion
                  </label>
                  <select id="info_religion" name="religion" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all">
                    <option value="">Select Religion</option>
                    <option value="Catholic">✝️ Catholic</option>
                    <option value="Protestant">✝️ Protestant</option>
                    <option value="Islam">☪️ Islam</option>
                    <option value="Buddhism">☸️ Buddhism</option>
                    <option value="Hinduism">🕉️ Hinduism</option>
                    <option value="Judaism">✡️ Judaism</option>
                    <option value="Iglesia ni Cristo">⛪ Iglesia ni Cristo</option>
                    <option value="Born Again">✝️ Born Again</option>
                    <option value="Other Christian">✝️ Other Christian</option>
                    <option value="Other">❓ Other</option>
                    <option value="None">🚫 None/Atheist</option>
                    <option value="Prefer not to say">🤐 Prefer not to say</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="info_nationality" class="block text-sm font-semibold text-slate-700 mb-2">
                    Nationality
                  </label>
                  <select id="info_nationality" name="nationality" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all">
                    <option value="">Select Nationality</option>
                    <option value="Filipino">🇵🇭 Filipino</option>
                    <option value="American">🇺🇸 American</option>
                    <option value="Canadian">🇨🇦 Canadian</option>
                    <option value="Australian">🇦🇺 Australian</option>
                    <option value="British">🇬🇧 British</option>
                    <option value="Japanese">🇯🇵 Japanese</option>
                    <option value="Korean">🇰🇷 Korean</option>
                    <option value="Chinese">🇨🇳 Chinese</option>
                    <option value="Other">🌍 Other</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Employment Information Section -->
            <div class="bg-gradient-to-br from-yellow-50 to-amber-50 p-6 rounded-xl border border-yellow-200 shadow-sm">
              <h4 class="font-bold text-yellow-800 mb-4 flex items-center gap-2">
                💼 Employment Information
              </h4>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="form-group">
                  <label for="info_occupation" class="block text-sm font-semibold text-slate-700 mb-2">
                    Occupation
                  </label>
                  <input 
                    id="info_occupation" 
                    name="occupation" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-yellow-100 focus:border-yellow-500 transition-all" 
                    placeholder="Job title or occupation"
                  />
                </div>
                <div class="form-group">
                  <label for="info_employer" class="block text-sm font-semibold text-slate-700 mb-2">
                    Employer/Company
                  </label>
                  <input 
                    id="info_employer" 
                    name="employer" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-yellow-100 focus:border-yellow-500 transition-all" 
                    placeholder="Company or organization name"
                  />
                </div>
                <div class="form-group">
                  <label for="info_workAddress" class="block text-sm font-semibold text-slate-700 mb-2">
                    Work Address
                  </label>
                  <input 
                    id="info_workAddress" 
                    name="workAddress" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-yellow-100 focus:border-yellow-500 transition-all" 
                    placeholder="Work location"
                  />
                </div>
                <div class="form-group">
                  <label for="info_workPhone" class="block text-sm font-semibold text-slate-700 mb-2">
                    Work Phone
                  </label>
                  <input 
                    id="info_workPhone" 
                    name="workPhone" 
                    type="tel" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-yellow-100 focus:border-yellow-500 transition-all" 
                    placeholder="+63 XXX XXX XXXX"
                    pattern="[+]?[\d\s\-()]{10,15}"
                    title="Please enter a valid phone number"
                  />
                </div>
                <div class="form-group">
                  <label for="info_employmentStatus" class="block text-sm font-semibold text-slate-700 mb-2">
                    Employment Status
                  </label>
                  <select id="info_employmentStatus" name="employmentStatus" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-yellow-100 focus:border-yellow-500 transition-all">
                    <option value="">Select Status</option>
                    <option value="Employed Full-time">💼 Employed Full-time</option>
                    <option value="Employed Part-time">🕐 Employed Part-time</option>
                    <option value="Self-employed">🏢 Self-employed</option>
                    <option value="Unemployed">❌ Unemployed</option>
                    <option value="Student">� Student</option>
                    <option value="Retired">🏖️ Retired</option>
                    <option value="Disabled">♿ Disabled</option>
                    <option value="Other">❓ Other</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Skip duplicate Emergency Contact Section -->
            <div style="display: none;">
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div>
                  <label for="info_emg_name" class="block text-sm font-semibold text-slate-700 mb-1">
                    Contact Name *
                  </label>
                  <input 
                    id="info_emg_name" 
                    name="emg_name" 
                    placeholder="Full name" 
                    class="w-full rounded-lg px-3 py-2 border focus:ring-2 focus:ring-red-500 focus:border-red-500" 
                    required 
                  />
                </div>
                <div>
                  <label for="info_emg_relation" class="block text-sm font-semibold text-slate-700 mb-1">
                    Relationship *
                  </label>
                  <input 
                    id="info_emg_relation" 
                    name="emg_relation" 
                    placeholder="Spouse, Parent, etc." 
                    class="w-full rounded-lg px-3 py-2 border focus:ring-2 focus:ring-red-500 focus:border-red-500" 
                    required 
                  />
                </div>
                <div>
                  <label for="info_emg_phone" class="block text-sm font-semibold text-slate-700 mb-1">
                    Phone Number *
                  </label>
                  <input 
                    id="info_emg_phone" 
                    name="emg_phone" 
                    placeholder="+63 XXX XXX XXXX" 
                    class="w-full rounded-lg px-3 py-2 border focus:ring-2 focus:ring-red-500 focus:border-red-500" 
                    required 
                  />
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t">
              <button 
                type="button" 
                id="saveInfoBtn" 
                data-save="info" 
                class="flex-1 px-6 py-3 bg-emerald-600 text-white rounded-lg font-semibold hover:bg-emerald-700 transition-colors flex items-center justify-center gap-2"
              >
                💾 Save Patient Information
              </button>
              <button 
                type="button" 
                id="validateInfo" 
                class="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors"
              >
                ✓ Validate
              </button>
            </div>
            
            <!-- Form Status -->
            <div id="infoStatus" class="hidden p-3 rounded-lg"></div>
          </form>
        </div>

        <!-- 2 • Identification & Insurance -->
        <div id="tab-id" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
              2 • Identification & Insurance
            </h3>
            <div class="flex items-center gap-2 text-sm text-slate-600">
              <span>Form Status:</span>
              <span id="idFormStatus" class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full font-medium">Incomplete</span>
            </div>
          </div>
          
          <form id="form-id" class="space-y-6">
            <!-- Government Identification Section -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 shadow-sm">
              <h4 class="font-bold text-blue-800 mb-4 flex items-center gap-2">
                🪪 Government Identification
                <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">Required</span>
              </h4>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="id_govIdType" class="block text-sm font-semibold text-slate-700 mb-2">
                    Primary Government ID *
                  </label>
                  <select id="id_govIdType" name="govIdType" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" required>
                    <option value="">Select Government ID</option>
                    <option value="Driver's License">🚗 Driver's License</option>
                    <option value="Passport">🛂 Passport</option>
                    <option value="National ID">🆔 National ID (PhilID)</option>
                    <option value="Voter ID">🗳️ Voter's ID</option>
                    <option value="SSS ID">📋 SSS ID</option>
                    <option value="GSIS ID">🏛️ GSIS ID</option>
                    <option value="TIN ID">📊 TIN ID</option>
                    <option value="Postal ID">📮 Postal ID</option>
                    <option value="Senior Citizen ID">👴 Senior Citizen ID</option>
                    <option value="PWD ID">♿ PWD ID</option>
                    <option value="Other">❓ Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="id_govIdNo" class="block text-sm font-semibold text-slate-700 mb-2">
                    ID Number *
                  </label>
                  <input 
                    id="id_govIdNo" 
                    name="govIdNo" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" 
                    placeholder="Enter ID number"
                    pattern="[A-Za-z0-9\-]{6,20}"
                    title="ID number should be 6-20 characters (letters, numbers, and hyphens only)"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="id_govIdExpiry" class="block text-sm font-semibold text-slate-700 mb-2">
                    ID Expiry Date
                  </label>
                  <input 
                    id="id_govIdExpiry" 
                    name="govIdExpiry" 
                    type="date" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all"
                  />
                </div>
                <div class="form-group">
                  <label for="id_placeOfIssue" class="block text-sm font-semibold text-slate-700 mb-2">
                    Place of Issue
                  </label>
                  <input 
                    id="id_placeOfIssue" 
                    name="placeOfIssue" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" 
                    placeholder="City/Province where ID was issued"
                  />
                </div>
              </div>
              
              <!-- Secondary ID -->
              <div class="mt-6 p-4 bg-blue-25 rounded-lg border border-blue-100">
                <h5 class="font-semibold text-blue-800 mb-3">📄 Secondary ID (Optional)</h5>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div class="form-group">
                    <label for="id_secondaryIdType" class="block text-sm font-semibold text-slate-700 mb-2">
                      Secondary ID Type
                    </label>
                    <select id="id_secondaryIdType" name="secondaryIdType" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all">
                      <option value="">Select Secondary ID</option>
                      <option value="Birth Certificate">📜 Birth Certificate</option>
                      <option value="Marriage Certificate">💒 Marriage Certificate</option>
                      <option value="Barangay Certificate">🏘️ Barangay Certificate</option>
                      <option value="Company ID">🏢 Company ID</option>
                      <option value="School ID">🎓 School ID</option>
                      <option value="Other">❓ Other</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="id_secondaryIdNo" class="block text-sm font-semibold text-slate-700 mb-2">
                      Secondary ID Number
                    </label>
                    <input 
                      id="id_secondaryIdNo" 
                      name="secondaryIdNo" 
                      class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" 
                      placeholder="Enter secondary ID number"
                    />
                  </div>
                </div>
              </div>
            </div>

            <!-- Insurance Information Section -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200 shadow-sm">
              <h4 class="font-bold text-green-800 mb-4 flex items-center gap-2">
                🏥 Insurance Information
              </h4>
              
              <div class="grid grid-cols-1 gap-4 mb-4">
                <div class="form-group">
                  <label for="id_coverageType" class="block text-sm font-semibold text-slate-700 mb-2">
                    Coverage Type *
                  </label>
                  <select id="id_coverageType" name="coverageType" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" required>
                    <option value="">Select Coverage Type</option>
                    <option value="PhilHealth">🏛️ PhilHealth (Government)</option>
                    <option value="Private Insurance">🏢 Private Insurance</option>
                    <option value="HMO">⚕️ HMO (Health Maintenance Organization)</option>
                    <option value="Corporate Plan">🏢 Corporate Health Plan</option>
                    <option value="Medicare">👴 Medicare</option>
                    <option value="Medicaid">🏥 Medicaid</option>
                    <option value="Self-pay">💰 Self-pay / No Insurance</option>
                    <option value="Other">❓ Other</option>
                  </select>
                </div>
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="id_insProvider" class="block text-sm font-semibold text-slate-700 mb-2">
                    Insurance Provider
                  </label>
                  <input 
                    id="id_insProvider" 
                    name="insuranceProvider" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                    placeholder="e.g., PhilHealth, Maxicare, Intellicare"
                  />
                </div>
                <div class="form-group">
                  <label for="id_policyNo" class="block text-sm font-semibold text-slate-700 mb-2">
                    Policy / Member Number
                  </label>
                  <input 
                    id="id_policyNo" 
                    name="policyNo" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                    placeholder="Enter policy or member number"
                    pattern="[A-Za-z0-9\-]{6,25}"
                    title="Policy number should be 6-25 characters"
                  />
                </div>
                <div class="form-group">
                  <label for="id_groupNumber" class="block text-sm font-semibold text-slate-700 mb-2">
                    Group Number
                  </label>
                  <input 
                    id="id_groupNumber" 
                    name="groupNumber" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                    placeholder="Group or company code"
                  />
                </div>
                <div class="form-group">
                  <label for="id_effectiveDate" class="block text-sm font-semibold text-slate-700 mb-2">
                    Effective Date
                  </label>
                  <input 
                    id="id_effectiveDate" 
                    name="effectiveDate" 
                    type="date" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all"
                  />
                </div>
                <div class="form-group">
                  <label for="id_expiryDate" class="block text-sm font-semibold text-slate-700 mb-2">
                    Expiry Date
                  </label>
                  <input 
                    id="id_expiryDate" 
                    name="expiryDate" 
                    type="date" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all"
                  />
                </div>
                <div class="form-group">
                  <label for="id_copayAmount" class="block text-sm font-semibold text-slate-700 mb-2">
                    Co-pay Amount (₱)
                  </label>
                  <input 
                    id="id_copayAmount" 
                    name="copayAmount" 
                    type="number" 
                    min="0" 
                    step="0.01" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                    placeholder="0.00"
                  />
                </div>
              </div>
            </div>

            <!-- Guarantor/Responsible Party Section -->
            <div class="bg-gradient-to-br from-orange-50 to-amber-50 p-6 rounded-xl border border-orange-200 shadow-sm">
              <h4 class="font-bold text-orange-800 mb-4 flex items-center gap-2">
                👥 Guarantor / Responsible Party
              </h4>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="id_guarantor" class="block text-sm font-semibold text-slate-700 mb-2">
                    Guarantor Name
                  </label>
                  <input 
                    id="id_guarantor" 
                    name="guarantor" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-orange-100 focus:border-orange-500 transition-all" 
                    placeholder="Full name of responsible party"
                  />
                </div>
                <div class="form-group">
                  <label for="id_guarantorRelation" class="block text-sm font-semibold text-slate-700 mb-2">
                    Relationship to Patient
                  </label>
                  <select id="id_guarantorRelation" name="guarantorRelation" class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-orange-100 focus:border-orange-500 transition-all">
                    <option value="">Select Relationship</option>
                    <option value="Self">👤 Self</option>
                    <option value="Spouse">👫 Spouse</option>
                    <option value="Parent">👨‍👩‍👦 Parent</option>
                    <option value="Child">👶 Child</option>
                    <option value="Sibling">👫 Sibling</option>
                    <option value="Guardian">🛡️ Legal Guardian</option>
                    <option value="Employer">🏢 Employer</option>
                    <option value="Other">❓ Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="id_guarantorPhone" class="block text-sm font-semibold text-slate-700 mb-2">
                    Guarantor Phone
                  </label>
                  <input 
                    id="id_guarantorPhone" 
                    name="guarantorPhone" 
                    type="tel" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-orange-100 focus:border-orange-500 transition-all" 
                    placeholder="+63 XXX XXX XXXX"
                    pattern="[+]?[\d\s\-()]{10,15}"
                    title="Please enter a valid phone number"
                  />
                </div>
                <div class="form-group">
                  <label for="id_guarantorAddress" class="block text-sm font-semibold text-slate-700 mb-2">
                    Guarantor Address
                  </label>
                  <input 
                    id="id_guarantorAddress" 
                    name="guarantorAddress" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-orange-100 focus:border-orange-500 transition-all" 
                    placeholder="Complete address"
                  />
                </div>
              </div>
            </div>

            <div>
              <label class="text-sm font-semibold">Employer (for billing)</label>
              <input id="id_employer" name="insuranceEmployer" class="mt-1 w-full rounded-lg px-3 py-2 border" />
            </div>
            <div>
              <label class="text-sm font-semibold">Notes / Special Authorizations</label>
              <input id="id_notes" name="insuranceNotes" class="mt-1 w-full rounded-lg px-3 py-2 border" />
            </div>

            <div class="sm:col-span-2 flex gap-2 mt-2">
              <button type="button" class="px-4 py-2 bg-sky-600 text-white rounded-lg" data-save="id">💾 Save ID & Insurance</button>
              <button type="button" id="clearID" class="px-4 py-2 bg-white rounded-lg border">Clear</button>
            </div>
          </form>
        </div>

        <!-- 3 • Medical History -->
        <div id="tab-history" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">
              3 • Medical History
            </h3>
            <div class="flex items-center gap-2 text-sm text-slate-600">
              <span>Completion:</span>
              <span id="historyProgress" class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full font-medium">0%</span>
            </div>
          </div>
          
          <form id="form-history" class="space-y-6">
            <!-- Chief Complaint & Present Illness -->
            <div class="bg-gradient-to-br from-red-50 to-pink-50 p-6 rounded-xl border border-red-200 shadow-sm">
              <h4 class="font-bold text-red-800 mb-4 flex items-center gap-2">
                🩺 Chief Complaint & Present Illness
                <span class="px-2 py-1 bg-red-100 text-red-700 text-xs rounded-full">Critical</span>
              </h4>
              
              <div class="space-y-4">
                <div class="form-group">
                  <label for="chiefComplaint" class="block text-sm font-semibold text-slate-700 mb-2">
                    Chief Complaint *
                  </label>
                  <div class="flex gap-3 items-start">
                    <input 
                      id="chiefComplaint" 
                      name="chiefComplaint" 
                      class="flex-1 rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-red-100 focus:border-red-500 transition-all" 
                      placeholder="Main reason for today's visit (e.g., chest pain, fever, cough)"
                      required
                    />
                    <div class="flex flex-col items-center gap-1 min-w-[100px]">
                      <label class="text-xs font-semibold text-slate-700">Pain Scale</label>
                      <select 
                        id="painScale" 
                        name="painScale" 
                        class="w-full rounded-lg px-3 py-2 border-2 border-slate-200 focus:ring-4 focus:ring-red-100 focus:border-red-500 transition-all text-center font-bold"
                        title="Pain scale: 0 = No pain, 10 = Worst imaginable pain"
                      >
                        <option value="na">N/A</option>
                        <option value="0">0️⃣ None</option>
                        <option value="1">1️⃣ Mild</option>
                        <option value="2">2️⃣</option>
                        <option value="3">3️⃣</option>
                        <option value="4">4️⃣ Moderate</option>
                        <option value="5">5️⃣</option>
                        <option value="6">6️⃣</option>
                        <option value="7">7️⃣ Severe</option>
                        <option value="8">8️⃣</option>
                        <option value="9">9️⃣</option>
                        <option value="10">🔟 Worst</option>
                      </select>
                    </div>
                  </div>
                </div>
                
                <div class="form-group">
                  <label for="historyPresentIllness" class="block text-sm font-semibold text-slate-700 mb-2">
                    History of Present Illness *
                  </label>
                  <textarea 
                    id="historyPresentIllness" 
                    name="historyPresentIllness" 
                    rows="4" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-red-100 focus:border-red-500 transition-all" 
                    placeholder="Describe: Onset (when did it start?), Duration, Character, Aggravating/Relieving factors, Associated symptoms, Previous episodes"
                    required
                  ></textarea>
                  <div class="text-xs text-slate-500 mt-1">Include: onset, duration, character, location, radiation, timing, context, modifying factors, associated signs/symptoms</div>
                </div>
              </div>
            </div>

            <!-- Past Medical & Surgical History -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 shadow-sm">
              <h4 class="font-bold text-blue-800 mb-4 flex items-center gap-2">
                📚 Past Medical & Surgical History
              </h4>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="pastMedicalHistory" class="block text-sm font-semibold text-slate-700 mb-2">
                    Past Medical History
                  </label>
                  <textarea 
                    id="pastMedicalHistory" 
                    name="pastMedicalHistory" 
                    rows="3" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" 
                    placeholder="List chronic conditions: diabetes, hypertension, asthma, etc. Include dates if known"
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="pastSurgicalHistory" class="block text-sm font-semibold text-slate-700 mb-2">
                    Past Surgical History
                  </label>
                  <textarea 
                    id="pastSurgicalHistory" 
                    name="pastSurgicalHistory" 
                    rows="3" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" 
                    placeholder="List surgeries with dates and complications (if any)"
                  ></textarea>
                </div>
              </div>
            </div>

            <!-- Current Medications & Allergies -->
            <div class="bg-gradient-to-br from-purple-50 to-violet-50 p-6 rounded-xl border border-purple-200 shadow-sm">
              <h4 class="font-bold text-purple-800 mb-4 flex items-center gap-2">
                💊 Medications & Allergies
                <span class="px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full">Important</span>
              </h4>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="currentMedications" class="block text-sm font-semibold text-slate-700 mb-2">
                    Current Medications
                  </label>
                  <textarea 
                    id="currentMedications" 
                    name="currentMedications" 
                    rows="4" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" 
                    placeholder="List all current medications including:&#10;• Name, strength, frequency&#10;• Over-the-counter medications&#10;• Vitamins and supplements&#10;• Herbal remedies"
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="allergySummary" class="block text-sm font-semibold text-slate-700 mb-2">
                    Allergies & Adverse Reactions
                  </label>
                  <textarea 
                    id="allergySummary" 
                    name="allergySummary" 
                    rows="4" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" 
                    placeholder="List allergies and reactions:&#10;• Drug allergies (specify reaction)&#10;• Food allergies&#10;• Environmental allergies&#10;• No known allergies (NKDA)"
                  ></textarea>
                </div>
              </div>
            </div>

            <!-- Social & Family History -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200 shadow-sm">
              <h4 class="font-bold text-green-800 mb-4 flex items-center gap-2">
                👥 Social & Family History
              </h4>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="socialHistory" class="block text-sm font-semibold text-slate-700 mb-2">
                    Social History
                  </label>
                  <textarea 
                    id="socialHistory" 
                    name="socialHistory" 
                    rows="4" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                    placeholder="Include:&#10;• Tobacco use (packs/day, years)&#10;• Alcohol consumption&#10;• Recreational drugs&#10;• Occupation & exposures&#10;• Living situation&#10;• Exercise habits"
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="familyHistory" class="block text-sm font-semibold text-slate-700 mb-2">
                    Family History
                  </label>
                  <textarea 
                    id="familyHistory" 
                    name="familyHistory" 
                    rows="4" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                    placeholder="Significant family medical history:&#10;• Heart disease, diabetes, cancer&#10;• Genetic disorders&#10;• Mental health conditions&#10;• Age and cause of death (if applicable)"
                  ></textarea>
                </div>
              </div>
            </div>

            <!-- Immunizations & Review of Systems -->
            <div class="bg-gradient-to-br from-orange-50 to-amber-50 p-6 rounded-xl border border-orange-200 shadow-sm">
              <h4 class="font-bold text-orange-800 mb-4 flex items-center gap-2">
                💉 Immunizations & Review of Systems
              </h4>
              
              <div class="space-y-4">
                <div class="form-group">
                  <label for="vaccineHistory" class="block text-sm font-semibold text-slate-700 mb-2">
                    Immunization History
                  </label>
                  <textarea 
                    id="vaccineHistory" 
                    name="vaccineHistory" 
                    rows="3" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-orange-100 focus:border-orange-500 transition-all" 
                    placeholder="Recent and important immunizations with dates:&#10;COVID-19, Influenza, Pneumonia, Hepatitis A/B, Tetanus/Diphtheria, MMR, etc."
                  ></textarea>
                </div>
                
                <div class="form-group">
                  <label for="reviewOfSystems" class="block text-sm font-semibold text-slate-700 mb-2">
                    Review of Systems
                  </label>
                  <textarea 
                    id="reviewOfSystems" 
                    name="reviewOfSystems" 
                    rows="4" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-orange-100 focus:border-orange-500 transition-all" 
                    placeholder="Systematic review by organ system:&#10;• Constitutional (fever, weight loss/gain, fatigue)&#10;• Cardiovascular, Respiratory, Gastrointestinal&#10;• Genitourinary, Neurological, Musculoskeletal&#10;• Skin, Psychiatric, Endocrine"
                  ></textarea>
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="flex gap-3 pt-4 border-t border-slate-200">
              <button type="button" data-save="history" class="flex-1 px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-semibold rounded-lg hover:from-emerald-600 hover:to-teal-600 transition-all shadow-lg hover:shadow-xl">
                💾 Save Medical History
              </button>
              <button type="button" id="clearHistory" class="px-6 py-3 bg-white text-slate-700 font-semibold rounded-lg border-2 border-slate-300 hover:bg-slate-50 transition-all">
                🗑️ Clear Form
              </button>
              <button type="button" id="printHistory" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-500 text-white font-semibold rounded-lg hover:from-blue-600 hover:to-indigo-600 transition-all shadow-lg hover:shadow-xl">
                🖨️ Print History
              </button>
            </div>
          </form>
        </div>

        <!-- 5 • Treatment Plan (was Assessment & Plan) -->
        <div id="tab-assessment" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <h3 class="text-xl font-bold mb-3">5 • Treatment Plan</h3>
          <form id="form-assessment" class="grid grid-cols-1 gap-4">
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
              <div>
                <label class="text-sm">Primary Problem / Working Dx</label>
                <input name="assessment_workingDx" class="w-full rounded-lg p-2 border" placeholder="Primary working diagnosis" />
              </div>
              <div>
                <label class="text-sm">Onset</label>
                <input name="assessment_onset" class="w-full rounded-lg p-2 border" placeholder="e.g., 2 days ago" />
              </div>
              <div>
                <label class="text-sm">Duration / Course</label>
                <input name="assessment_duration" class="w-full rounded-lg p-2 border" placeholder="hours / days / chronic" />
              </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
              <div>
                <label class="text-sm">Severity</label>
                <select name="assessment_severity" class="w-full rounded-lg p-2 border"><option>Mild</option><option>Moderate</option><option>Severe</option></select>
              </div>
              <div>
                <label class="text-sm">Acuity</label>
                <select name="assessment_acuity" class="w-full rounded-lg p-2 border"><option>Acute</option><option>Chronic</option><option>Acute on chronic</option></select>
              </div>
              <div>
                <label class="text-sm">Status</label>
                <select name="assessment_status" class="w-full rounded-lg p-2 border"><option>Active</option><option>Resolved</option><option>Under observation</option></select>
              </div>
            </div>

            <div>
              <label class="text-sm">Pertinent Exam Findings</label>
              <textarea name="assessment_examFindings" class="w-full rounded-lg p-3 border" placeholder="Key physical exam findings relevant to this assessment"></textarea>
            </div>

            <div>
              <label class="text-sm">Differential Diagnoses</label>
              <textarea name="assessment_differential" class="w-full rounded-lg p-3 border" placeholder="List differential diagnoses in order of likelihood"></textarea>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label class="text-sm">ICD-10 / SNOMED Code</label>
                <input name="assessment_code" class="w-full rounded-lg p-2 border" placeholder="Optional code" />
              </div>
              <div>
                <label class="text-sm">Priority</label>
                <select name="assessment_priority" class="w-full rounded-lg p-2 border"><option>Routine</option><option>Urgent</option><option>Stat</option></select>
              </div>
            </div>

            <div>
              <label class="text-sm">Investigations / Orders</label>
              <textarea name="assessment_investigations" class="w-full rounded-lg p-3 border" placeholder="Lab tests, imaging, other investigations to order (specimen, priority)"></textarea>
            </div>

            <div>
              <label class="text-sm">Consults / Referrals</label>
              <input name="assessment_consults" class="w-full rounded-lg p-2 border" placeholder="Requested consults (e.g., Cardiology)" />
            </div>

            <div>
              <label class="text-sm">Treatment / Procedures Ordered</label>
              <textarea name="assessment_treatmentOrders" class="w-full rounded-lg p-3 border" placeholder="Medications, fluids, procedures, O2, wound care"></textarea>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label class="text-sm">Disposition / Plan</label>
                <select name="assessment_disposition" class="w-full rounded-lg p-2 border"><option>Admit</option><option>Discharge</option><option>Transfer</option><option>Observation</option></select>
              </div>
              <div>
                <label class="text-sm">Follow-up / Next Step</label>
                <input name="assessment_followup" class="w-full rounded-lg p-2 border" placeholder="Follow-up date, clinic, or action" />
              </div>
            </div>

            <div>
              <label class="text-sm">Additional Notes / Safety Netting</label>
              <textarea name="assessment_notes" class="w-full rounded-lg p-3 border" placeholder="Warnings, red flags, phone advice"></textarea>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 items-end">
              <div>
                <label class="text-sm">Signed by</label>
                <input name="assessment_signedBy" class="w-full rounded-lg p-2 border" placeholder="Provider name" />
              </div>
              <div>
                <label class="text-sm">Signature / ID</label>
                <input name="assessment_signature" class="w-full rounded-lg p-2 border" placeholder="Provider ID or initials" />
              </div>
              <div>
                <label class="text-sm">Signed at</label>
                <input name="assessment_signedAt" type="datetime-local" class="w-full rounded-lg p-2 border" />
              </div>
            </div>

            <div class="mt-2">
              <button type="button" data-save="assessment" class="px-4 py-2 bg-sky-600 text-white rounded-lg">💾 Save Assessment</button>
            </div>
          </form>
        </div>

        <!-- 4 • Physical Assessment -->
        <div id="tab-physical" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-2xl font-bold bg-gradient-to-r from-sky-600 to-blue-600 bg-clip-text text-transparent">
                4 • Physical Assessment
              </h3>
              <p class="text-sm text-slate-500 mt-1">Comprehensive physical examination and vital measurements</p>
            </div>
            <div class="flex items-center gap-2 text-sm text-slate-600">
              <span>Assessment Status:</span>
              <span id="physicalFormStatus" class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full font-medium">Incomplete</span>
            </div>
          </div>
          
          <form id="form-physical" class="space-y-6">
            
            <!-- Vital Measurements Section -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 shadow-sm">
              <h4 class="font-bold text-blue-800 mb-4 flex items-center gap-2">
                📏 Vital Measurements
                <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">Auto-calculations</span>
              </h4>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="form-group">
                  <label for="physical_weight" class="block text-sm font-semibold text-slate-700 mb-2">
                    Weight (kg) *
                  </label>
                  <input 
                    id="physical_weight" 
                    name="weight" 
                    type="number" 
                    step="0.1" 
                    min="0" 
                    max="300"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" 
                    placeholder="e.g., 72.5"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="physical_height" class="block text-sm font-semibold text-slate-700 mb-2">
                    Height (cm) *
                  </label>
                  <input 
                    id="physical_height" 
                    name="height" 
                    type="number" 
                    step="0.1" 
                    min="0" 
                    max="250"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" 
                    placeholder="e.g., 175"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="physical_bmi" class="block text-sm font-semibold text-slate-700 mb-2">
                    BMI
                  </label>
                  <input 
                    id="physical_bmi" 
                    name="bmi" 
                    type="text" 
                    readonly 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 bg-slate-50 transition-all" 
                    placeholder="Auto-calculated"
                  />
                  <div id="physical_bmiCategory" class="text-xs mt-1 font-medium">—</div>
                </div>
                <div class="form-group">
                  <label for="physical_bodyFat" class="block text-sm font-semibold text-slate-700 mb-2">
                    Body Fat % (Optional)
                  </label>
                  <input 
                    id="physical_bodyFat" 
                    name="bodyFat" 
                    type="number" 
                    step="0.1" 
                    min="0" 
                    max="50"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" 
                    placeholder="e.g., 15.2"
                  />
                </div>
              </div>
            </div>

            <!-- Primary Assessment Section -->
            <div class="bg-gradient-to-br from-red-50 to-pink-50 p-6 rounded-xl border border-red-200 shadow-sm">
              <h4 class="font-bold text-red-800 mb-4 flex items-center gap-2">
                🩺 Primary Assessment
                <span class="px-2 py-1 bg-red-100 text-red-700 text-xs rounded-full">Required</span>
              </h4>
              
              <div class="grid grid-cols-1 gap-4">
                <div class="form-group">
                  <label for="physical_initialDiagnosis" class="block text-sm font-semibold text-slate-700 mb-2">
                    Initial / Primary Diagnosis *
                  </label>
                  <input 
                    id="physical_initialDiagnosis" 
                    name="initialDiagnosis" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-red-100 focus:border-red-500 transition-all" 
                    placeholder="Primary clinical impression or diagnosis"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="physical_chiefComplaint" class="block text-sm font-semibold text-slate-700 mb-2">
                    Chief Complaint
                  </label>
                  <textarea 
                    id="physical_chiefComplaint" 
                    name="chiefComplaint" 
                    rows="2"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-red-100 focus:border-red-500 transition-all" 
                    placeholder="Patient's primary concern or reason for visit"
                  ></textarea>
                </div>
              </div>
            </div>

            <!-- Systems Examination Section -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200 shadow-sm">
              <h4 class="font-bold text-green-800 mb-4 flex items-center gap-2">
                🔍 Systems Examination
              </h4>
              
              <!-- General Appearance -->
              <div class="form-group mb-4">
                <label for="physical_appearance" class="block text-sm font-semibold text-slate-700 mb-2">
                  General Appearance & Mental Status
                </label>
                <textarea 
                  id="physical_appearance" 
                  name="physical_appearance" 
                  rows="3"
                  class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                  placeholder="General appearance, level of distress, mental status, orientation, cooperation..."
                ></textarea>
              </div>
              
              <!-- Cardiovascular & Respiratory -->
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                <div class="form-group">
                  <label for="physical_cv" class="block text-sm font-semibold text-slate-700 mb-2">
                    Cardiovascular System
                  </label>
                  <textarea 
                    id="physical_cv" 
                    name="physical_cv" 
                    rows="4"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                    placeholder="Heart rate, rhythm, heart sounds, murmurs, peripheral pulses, capillary refill..."
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="physical_lungs" class="block text-sm font-semibold text-slate-700 mb-2">
                    Respiratory System
                  </label>
                  <textarea 
                    id="physical_lungs" 
                    name="physical_lungs" 
                    rows="4"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                    placeholder="Respiratory rate, effort, chest expansion, breath sounds, adventitious sounds..."
                  ></textarea>
                </div>
              </div>
              
              <!-- Abdominal & GI -->
              <div class="form-group mb-4">
                <label for="physical_abdomen" class="block text-sm font-semibold text-slate-700 mb-2">
                  Abdominal & Gastrointestinal System
                </label>
                <textarea 
                  id="physical_abdomen" 
                  name="physical_abdomen" 
                  rows="3"
                  class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                  placeholder="Inspection, palpation findings, tenderness, masses, organomegaly, bowel sounds..."
                ></textarea>
              </div>
              
              <!-- Neurological & Extremities -->
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="physical_neuro" class="block text-sm font-semibold text-slate-700 mb-2">
                    Neurological System
                  </label>
                  <textarea 
                    id="physical_neuro" 
                    name="physical_neuro" 
                    rows="4"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                    placeholder="Cranial nerves, motor strength, sensation, reflexes, coordination, gait..."
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="physical_extremities" class="block text-sm font-semibold text-slate-700 mb-2">
                    Extremities & Musculoskeletal
                  </label>
                  <textarea 
                    id="physical_extremities" 
                    name="physical_extremities" 
                    rows="4"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                    placeholder="Range of motion, deformities, edema, muscle tone, joint stability..."
                  ></textarea>
                </div>
              </div>
            </div>

            <!-- Additional Systems Section -->
            <div class="bg-gradient-to-br from-purple-50 to-violet-50 p-6 rounded-xl border border-purple-200 shadow-sm">
              <h4 class="font-bold text-purple-800 mb-4 flex items-center gap-2">
                🔬 Additional Systems
              </h4>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="physical_skin" class="block text-sm font-semibold text-slate-700 mb-2">
                    Skin & Integumentary
                  </label>
                  <textarea 
                    id="physical_skin" 
                    name="physical_skin" 
                    rows="3"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" 
                    placeholder="Color, texture, lesions, rashes, wounds, temperature..."
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="physical_heent" class="block text-sm font-semibold text-slate-700 mb-2">
                    HEENT (Head, Eyes, Ears, Nose, Throat)
                  </label>
                  <textarea 
                    id="physical_heent" 
                    name="physical_heent" 
                    rows="3"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" 
                    placeholder="Pupils, extraocular movements, hearing, throat, lymph nodes..."
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="physical_genitourinary" class="block text-sm font-semibold text-slate-700 mb-2">
                    Genitourinary System
                  </label>
                  <textarea 
                    id="physical_genitourinary" 
                    name="physical_genitourinary" 
                    rows="3"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" 
                    placeholder="Urinary symptoms, renal function, reproductive health (if applicable)..."
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="physical_other" class="block text-sm font-semibold text-slate-700 mb-2">
                    Other Findings
                  </label>
                  <textarea 
                    id="physical_other" 
                    name="physical_other" 
                    rows="3"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-purple-100 focus:border-purple-500 transition-all" 
                    placeholder="Any additional findings or observations..."
                  ></textarea>
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t">
              <button 
                type="button" 
                data-save="physical" 
                class="flex-1 px-6 py-3 bg-sky-600 text-white rounded-lg font-semibold hover:bg-sky-700 transition-colors flex items-center justify-center gap-2"
              >
                💾 Save Physical Assessment
              </button>
              <button 
                type="button" 
                id="validatePhysical" 
                class="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors"
              >
                ✓ Validate
              </button>
              <button 
                type="button" 
                id="clearPhysical" 
                class="px-6 py-3 bg-slate-600 text-white rounded-lg font-semibold hover:bg-slate-700 transition-colors"
              >
                🗑️ Clear
              </button>
            </div>
            
            <!-- Form Status -->
            <div id="physicalStatus" class="hidden p-3 rounded-lg"></div>
          </form>
        </div>

        <!-- 7 • Labs -->
        <!-- 7 • Laboratory & Diagnostics -->
        <div id="tab-labs" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-2xl font-bold bg-gradient-to-r from-teal-600 to-cyan-600 bg-clip-text text-transparent">
                7 • Laboratory & Diagnostics
              </h3>
              <p class="text-sm text-slate-500 mt-1">Order tests, upload results, and manage diagnostic imaging</p>
            </div>
            <div class="flex items-center gap-2 text-sm text-slate-600">
              <span>Lab Status:</span>
              <span id="labFormStatus" class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full font-medium">Active</span>
            </div>
          </div>
          
          <form id="form-labs" class="space-y-6">
            
            <!-- Lab Order Section -->
            <div class="bg-gradient-to-br from-teal-50 to-cyan-50 p-6 rounded-xl border border-teal-200 shadow-sm">
              <h4 class="font-bold text-teal-800 mb-4 flex items-center gap-2">
                🧪 Laboratory Orders
                <span class="px-2 py-1 bg-teal-100 text-teal-700 text-xs rounded-full">CPOE System</span>
              </h4>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="form-group">
                  <label for="lab_test" class="block text-sm font-semibold text-slate-700 mb-2">
                    Test / Imaging *
                  </label>
                  <select 
                    id="lab_test" 
                    name="lab_test" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-teal-100 focus:border-teal-500 transition-all"
                    required
                  >
                    <option value="">Select Test Type</option>
                    <optgroup label="🩸 Hematology">
                      <option value="CBC">CBC (Complete Blood Count)</option>
                      <option value="CBC with Diff">CBC with Differential</option>
                      <option value="PT/PTT">PT/PTT/INR</option>
                      <option value="ESR">ESR (Erythrocyte Sedimentation Rate)</option>
                    </optgroup>
                    <optgroup label="🧪 Chemistry">
                      <option value="Basic Metabolic Panel">Basic Metabolic Panel</option>
                      <option value="Comprehensive Metabolic Panel">Comprehensive Metabolic Panel</option>
                      <option value="Lipid Panel">Lipid Panel</option>
                      <option value="Liver Function">Liver Function Tests</option>
                      <option value="Thyroid Function">Thyroid Function Tests</option>
                      <option value="HbA1c">HbA1c</option>
                      <option value="Glucose">Glucose (Random/Fasting)</option>
                    </optgroup>
                    <optgroup label="🦠 Microbiology">
                      <option value="Blood Culture">Blood Culture</option>
                      <option value="Urine Culture">Urine Culture</option>
                      <option value="Wound Culture">Wound Culture</option>
                      <option value="Sputum Culture">Sputum Culture</option>
                    </optgroup>
                    <optgroup label="📸 Imaging">
                      <option value="Chest X-ray">Chest X-ray</option>
                      <option value="Abdominal X-ray">Abdominal X-ray</option>
                      <option value="CT Scan">CT Scan</option>
                      <option value="MRI">MRI</option>
                      <option value="Ultrasound">Ultrasound</option>
                      <option value="ECG">ECG/EKG</option>
                      <option value="Echo">Echocardiogram</option>
                    </optgroup>
                    <optgroup label="🔬 Other">
                      <option value="Urinalysis">Urinalysis</option>
                      <option value="Stool Analysis">Stool Analysis</option>
                      <option value="Arterial Blood Gas">Arterial Blood Gas (ABG)</option>
                      <option value="Custom">Custom Test (specify below)</option>
                    </optgroup>
                  </select>
                </div>
                <div class="form-group">
                  <label for="lab_priority" class="block text-sm font-semibold text-slate-700 mb-2">
                    Priority *
                  </label>
                  <select 
                    id="lab_priority" 
                    name="lab_priority" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-teal-100 focus:border-teal-500 transition-all"
                    required
                  >
                    <option value="">Select Priority</option>
                    <option value="Routine">🟢 Routine (24-48 hours)</option>
                    <option value="Urgent">🟡 Urgent (2-4 hours)</option>
                    <option value="Stat">🔴 STAT (Immediate)</option>
                    <option value="Timed">⏰ Timed Collection</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="lab_specimen" class="block text-sm font-semibold text-slate-700 mb-2">
                    Specimen Type
                  </label>
                  <select 
                    id="lab_specimen" 
                    name="lab_specimen" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-teal-100 focus:border-teal-500 transition-all"
                  >
                    <option value="">Select Specimen</option>
                    <option value="Blood">🩸 Blood (Venous)</option>
                    <option value="Blood Arterial">🩸 Blood (Arterial)</option>
                    <option value="Urine">💧 Urine</option>
                    <option value="Stool">💩 Stool</option>
                    <option value="Sputum">🫁 Sputum</option>
                    <option value="Wound Swab">🩹 Wound Swab</option>
                    <option value="Throat Swab">👄 Throat Swab</option>
                    <option value="CSF">🧠 Cerebrospinal Fluid</option>
                    <option value="Tissue">🔬 Tissue</option>
                    <option value="N/A">N/A (Imaging)</option>
                  </select>
                </div>
              </div>
              
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                <div class="form-group">
                  <label for="lab_customTest" class="block text-sm font-semibold text-slate-700 mb-2">
                    Custom Test Name
                  </label>
                  <input 
                    id="lab_customTest" 
                    name="lab_customTest" 
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-teal-100 focus:border-teal-500 transition-all" 
                    placeholder="Enter custom test name (if selected above)"
                  />
                </div>
                <div class="form-group">
                  <label for="lab_orderDateTime" class="block text-sm font-semibold text-slate-700 mb-2">
                    Order Date & Time
                  </label>
                  <input 
                    id="lab_orderDateTime" 
                    name="lab_orderDateTime" 
                    type="datetime-local"
                    class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-teal-100 focus:border-teal-500 transition-all"
                  />
                </div>
              </div>
              
              <div class="form-group mt-4">
                <label for="lab_indication" class="block text-sm font-semibold text-slate-700 mb-2">
                  Clinical Indication / Notes *
                </label>
                <textarea 
                  id="lab_indication" 
                  name="lab_indication" 
                  rows="3"
                  class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-teal-100 focus:border-teal-500 transition-all" 
                  placeholder="Clinical reason for ordering this test, relevant symptoms, differential diagnosis..."
                  required
                ></textarea>
              </div>
            </div>

            <!-- Results Upload Section -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 shadow-sm">
              <h4 class="font-bold text-blue-800 mb-4 flex items-center gap-2">
                📄 Results & Documentation
              </h4>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- File Upload -->
                <div class="space-y-4">
                  <div class="form-group">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">
                      Upload Lab Results / Images
                    </label>
                    <div class="border-2 border-dashed border-blue-300 rounded-lg p-6 text-center hover:border-blue-400 transition-colors">
                      <input 
                        accept="image/*,.pdf,.doc,.docx,.txt" 
                        id="labFileInput" 
                        type="file" 
                        multiple
                        class="hidden"
                      />
                      <label for="labFileInput" class="cursor-pointer">
                        <div class="text-4xl mb-2">📁</div>
                        <div class="text-sm font-medium text-blue-600">Click to upload files</div>
                        <div class="text-xs text-slate-500 mt-1">PDF, Images, Documents (Max 10MB each)</div>
                      </label>
                    </div>
                  </div>
                  
                  <button 
                    type="button" 
                    id="uploadLabBtn" 
                    class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50"
                  >
                    ⬆️ Upload Selected Files
                  </button>
                  
                  <div id="uploadProgress" class="hidden">
                    <div class="w-full bg-slate-200 rounded-full h-3 overflow-hidden">
                      <div id="uploadProgressBar" class="h-3 bg-blue-600 w-0 transition-all duration-300"></div>
                    </div>
                    <div id="uploadProgressText" class="text-sm text-slate-600 mt-2 text-center">0%</div>
                  </div>
                </div>
                
                <!-- Manual Results Entry -->
                <div class="space-y-4">
                  <div class="form-group">
                    <label for="lab_results" class="block text-sm font-semibold text-slate-700 mb-2">
                      Manual Results Entry
                    </label>
                    <textarea 
                      id="lab_results" 
                      name="lab_results" 
                      rows="6"
                      class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all font-mono text-sm" 
                      placeholder="Enter lab results manually:&#10;&#10;WBC: 8.5 x10³/μL&#10;RBC: 4.2 x10⁶/μL&#10;Hgb: 12.8 g/dL&#10;Hct: 38.5%&#10;..."
                    ></textarea>
                  </div>
                  
                  <div class="form-group">
                    <label for="lab_interpretation" class="block text-sm font-semibold text-slate-700 mb-2">
                      Interpretation / Comments
                    </label>
                    <textarea 
                      id="lab_interpretation" 
                      name="lab_interpretation" 
                      rows="3"
                      class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all" 
                      placeholder="Clinical interpretation, significance, follow-up recommendations..."
                    ></textarea>
                  </div>
                </div>
              </div>
              
              <!-- Uploaded Files Display -->
              <div id="labFilesList" class="mt-6">
                <h5 class="text-sm font-semibold text-slate-700 mb-3">Uploaded Files:</h5>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3" id="labFilesGrid">
                  <!-- Files will be displayed here -->
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t">
              <button 
                type="button" 
                data-save="labs" 
                class="flex-1 px-6 py-3 bg-teal-600 text-white rounded-lg font-semibold hover:bg-teal-700 transition-colors flex items-center justify-center gap-2"
              >
                💾 Save Lab Order
              </button>
              <button 
                type="button" 
                id="addLabOrder" 
                class="px-6 py-3 bg-cyan-600 text-white rounded-lg font-semibold hover:bg-cyan-700 transition-colors"
              >
                ➕ Add Another
              </button>
              <button 
                type="button" 
                id="clearLabs" 
                class="px-6 py-3 bg-slate-600 text-white rounded-lg font-semibold hover:bg-slate-700 transition-colors"
              >
                🗑️ Clear Form
              </button>
            </div>
            
            <!-- Lab Orders History -->
            <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
              <h5 class="font-semibold text-slate-700 mb-3">📋 Recent Lab Orders</h5>
              <div id="labOrdersHistory" class="space-y-2">
                <div class="text-sm text-slate-500 italic">No lab orders yet</div>
              </div>
            </div>
            
            <!-- Lab Trends and Analytics -->
            <div class="bg-gradient-to-br from-indigo-50 to-purple-50 p-4 rounded-xl border border-indigo-200">
              <h5 class="font-semibold text-indigo-700 mb-3">📈 Lab Trends & Analytics</h5>
              <div id="labTrendsDisplay" class="space-y-3">
                <div class="text-sm text-slate-500 italic">No trend data available</div>
              </div>
              
              <!-- Quick Lab Analysis Tools -->
              <div class="mt-4 pt-4 border-t border-indigo-200">
                <h6 class="font-medium text-indigo-700 mb-2">Quick Analysis Tools</h6>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                  <button 
                    type="button" 
                    onclick="labResultsManager.generateLabSummary()" 
                    class="px-3 py-2 bg-indigo-100 text-indigo-800 rounded-lg hover:bg-indigo-200 transition-colors text-sm"
                  >
                    📊 Generate Lab Summary
                  </button>
                  <button 
                    type="button" 
                    onclick="labResultsManager.exportLabData()" 
                    class="px-3 py-2 bg-purple-100 text-purple-800 rounded-lg hover:bg-purple-200 transition-colors text-sm"
                  >
                    📤 Export Lab Data
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>

        <!-- 6 • Medication & IV Order -->
        <div id="tab-meds" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="text-2xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">
                6 • Medication & IV Order
              </h3>
              <p class="text-sm text-slate-500 mt-1">Computerized Provider Order Entry with clinical decision support</p>
            </div>
            <div class="flex items-center gap-2">
              <div class="flex items-center gap-2 px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                CDS Active
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Enhanced CPOE form with safety checks -->
            <div class="space-y-4">
              <div class="p-4 rounded-xl border-2 border-green-200 bg-gradient-to-br from-green-50 to-emerald-50 shadow-sm">
                <div class="flex items-center gap-2 mb-4">
                  <span class="text-xl">💊</span>
                  <div class="text-lg font-bold text-green-800">CPOE - New Order</div>
                </div>
                
                <form id="medCPOEForm" class="space-y-3">
                  <!-- Drug name with autocomplete -->
                  <div class="space-y-2">
                    <label class="block text-sm font-semibold text-slate-700">Drug Name *</label>
                    <div class="relative">
                      <input 
                        id="cpoe_drug" 
                        name="drug" 
                        placeholder="Start typing drug name..." 
                        class="w-full rounded-lg px-4 py-3 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                        required 
                        list="drugList"
                      />
                      <datalist id="drugList">
                        <option value="Paracetamol (Acetaminophen)">
                        <option value="Ibuprofen">
                        <option value="Aspirin">
                        <option value="Amoxicillin">
                        <option value="Omeprazole">
                        <option value="Simvastatin">
                        <option value="Metformin">
                        <option value="Lisinopril">
                        <option value="Amlodipine">
                        <option value="Atorvastatin">
                        <option value="Furosemide">
                        <option value="Warfarin">
                        <option value="Digoxin">
                        <option value="Insulin">
                        <option value="Morphine">
                      </datalist>
                      <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
                        <span id="drugSafetyIcon" class="text-gray-400">💊</span>
                      </div>
                    </div>
                    <div id="drugSafetyAlerts" class="space-y-1"></div>
                  </div>

                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                      <label class="block text-sm font-semibold text-slate-700 mb-1">Dosage</label>
                      <input 
                        id="cpoe_dosage" 
                        name="dosage" 
                        placeholder="e.g., 500 mg" 
                        class="w-full rounded-lg px-3 py-2 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                      />
                    </div>
                    <div>
                      <label class="block text-sm font-semibold text-slate-700 mb-1">Route</label>
                      <select 
                        id="cpoe_route" 
                        name="route" 
                        class="w-full rounded-lg px-3 py-2 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all"
                      >
                        <option value="">Select Route</option>
                        <option value="PO">💊 PO (Oral)</option>
                        <option value="IV">💉 IV (Intravenous)</option>
                        <option value="IM">🔹 IM (Intramuscular)</option>
                        <option value="SC">🔸 SC (Subcutaneous)</option>
                        <option value="SL">👅 SL (Sublingual)</option>
                        <option value="PR">🔻 PR (Rectal)</option>
                        <option value="Topical">🧴 Topical</option>
                        <option value="Inhaled">💨 Inhaled</option>
                      </select>
                    </div>
                  </div>

                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                      <label class="block text-sm font-semibold text-slate-700 mb-1">Frequency</label>
                      <select 
                        id="cpoe_frequency" 
                        name="frequency" 
                        class="w-full rounded-lg px-3 py-2 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all"
                      >
                        <option value="">Select Frequency</option>
                        <option value="STAT">⚡ STAT (Immediately)</option>
                        <option value="Daily">📅 Daily</option>
                        <option value="BID">🔄 BID (Twice daily)</option>
                        <option value="TID">⏰ TID (Three times daily)</option>
                        <option value="QID">🕐 QID (Four times daily)</option>
                        <option value="Q4H">⏱️ Q4H (Every 4 hours)</option>
                        <option value="Q6H">⏲️ Q6H (Every 6 hours)</option>
                        <option value="Q8H">⏰ Q8H (Every 8 hours)</option>
                        <option value="Q12H">🕐 Q12H (Every 12 hours)</option>
                        <option value="PRN">🆘 PRN (As needed)</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-semibold text-slate-700 mb-1">Priority</label>
                      <select 
                        id="cpoe_priority" 
                        name="priority" 
                        class="w-full rounded-lg px-3 py-2 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all"
                      >
                        <option value="Routine">📋 Routine</option>
                        <option value="Urgent">⚠️ Urgent</option>
                        <option value="STAT">🚨 STAT</option>
                      </select>
                    </div>
                  </div>

                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                      <label class="block text-sm font-semibold text-slate-700 mb-1">Start Date</label>
                      <input 
                        id="cpoe_start" 
                        name="startDate" 
                        type="date" 
                        class="w-full rounded-lg px-3 py-2 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                      />
                    </div>
                    <div>
                      <label class="block text-sm font-semibold text-slate-700 mb-1">Duration</label>
                      <input 
                        id="cpoe_duration" 
                        name="duration" 
                        placeholder="e.g., 5 days, 2 weeks" 
                        class="w-full rounded-lg px-3 py-2 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                      />
                    </div>
                  </div>

                  <!-- Dosing Guidelines Panel -->
                  <div id="dosingGuidelines" class="hidden p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <h5 class="font-semibold text-blue-800 mb-2">📖 Dosing Guidelines</h5>
                    <div id="dosingContent" class="text-sm text-blue-700"></div>
                  </div>

                  <!-- IV Fluids Section (Enhanced) -->
                  <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200">
                    <div class="flex items-center gap-2 mb-3">
                      <span class="text-lg">💧</span>
                      <div class="text-sm font-bold text-blue-800">IV FLUIDS</div>
                    </div>
                    <div class="space-y-3">
                      <div>
                        <label class="block text-xs font-semibold text-blue-700 mb-1">IV Fluid Type</label>
                        <select 
                          id="cpoe_iv_fluid" 
                          name="iv_fluid" 
                          class="w-full rounded-lg px-3 py-2 border-2 border-blue-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all text-sm"
                        >
                          <option value="">— Select IV Fluid —</option>
                          <option value="NS">🧂 NS (Normal Saline, 0.9% NaCl)</option>
                          <option value="0.45% NaCl">💧 0.45% NaCl (Half Normal Saline)</option>
                          <option value="LR">🔄 LR (Lactated Ringer's Solution)</option>
                          <option value="D5LR">🍯 D5LR (5% Dextrose & Lactate Ringer)</option>
                          <option value="D5W">🍯 D5W (Dextrose 5% in Water)</option>
                          <option value="D5NS">🍯 D5NS (Dextrose 5% in Normal Saline)</option>
                          <option value="D5 0.45% NaCl">🍯 D5 0.45% NaCl</option>
                          <option value="D10W">🍯 D10W (Dextrose 10% in Water)</option>
                        </select>
                      </div>
                      <div class="grid grid-cols-2 gap-2">
                        <div>
                          <label class="block text-xs font-semibold text-blue-700 mb-1">Rate (mL/hr)</label>
                          <input 
                            id="cpoe_iv_ml_hr" 
                            name="iv_ml_hr" 
                            type="number" 
                            step="0.1" 
                            placeholder="125" 
                            class="w-full rounded-lg px-3 py-2 border-2 border-blue-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all text-sm" 
                          />
                        </div>
                        <div>
                          <label class="block text-xs font-semibold text-blue-700 mb-1">Drops (gtt/min)</label>
                          <input 
                            id="cpoe_iv_gtt_min" 
                            name="iv_gtt_min" 
                            type="number" 
                            step="1" 
                            placeholder="31" 
                            class="w-full rounded-lg px-3 py-2 border-2 border-blue-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all text-sm" 
                          />
                        </div>
                      </div>
                      <div class="grid grid-cols-2 gap-2">
                        <div>
                          <label class="block text-xs font-semibold text-blue-700 mb-1">Volume (mL)</label>
                          <input 
                            id="cpoe_iv_volume" 
                            name="iv_volume" 
                            type="number" 
                            placeholder="1000" 
                            class="w-full rounded-lg px-3 py-2 border-2 border-blue-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all text-sm" 
                          />
                        </div>
                        <div>
                          <label class="block text-xs font-semibold text-blue-700 mb-1">Time (hrs)</label>
                          <input 
                            id="cpoe_iv_time" 
                            name="iv_time" 
                            type="number" 
                            step="0.5" 
                            placeholder="8" 
                            class="w-full rounded-lg px-3 py-2 border-2 border-blue-200 focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all text-sm" 
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                      <label class="block text-sm font-semibold text-slate-700 mb-1">PRN Status</label>
                      <select 
                        id="cpoe_prn" 
                        name="prn" 
                        class="w-full rounded-lg px-3 py-2 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all"
                      >
                        <option value="No">📅 Scheduled</option>
                        <option value="Yes">🆘 PRN (As Needed)</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-semibold text-slate-700 mb-1">Ordering Provider</label>
                      <input 
                        id="cpoe_prescriber" 
                        name="prescriber" 
                        placeholder="Provider name" 
                        class="w-full rounded-lg px-3 py-2 border-2 border-slate-200 focus:ring-4 focus:ring-green-100 focus:border-green-500 transition-all" 
                      />
                    </div>
                  </div>

                  <!-- Action Buttons -->
                  <div class="flex flex-col gap-2 pt-3 border-t border-green-200">
                    <button 
                      type="button" 
                      id="addMedOrderBtn" 
                      class="w-full px-4 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors flex items-center justify-center gap-2"
                    >
                      ➕ Add to Orders
                    </button>
                    <div class="grid grid-cols-2 gap-2">
                      <button 
                        type="button" 
                        id="sendToPharmacy" 
                        class="px-3 py-2 bg-amber-500 text-white rounded-lg text-sm font-medium hover:bg-amber-600 transition-colors"
                      >
                        📤 Send to Pharmacy
                      </button>
                      <button 
                        type="button" 
                        id="cpoeClear" 
                        class="px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors"
                      >
                        🗑️ Clear Form
                      </button>
                    </div>
                  </div>
                </form>
              </div>

              <!-- Clinical Decision Support Alerts -->
              <div id="medAlerts" class="space-y-2"></div>
            </div>

            <!-- Center: Active medication list -->
            <div class="lg:col-span-2">
              <div class="p-3 rounded border bg-white/50 mb-3 flex items-center justify-between">
                <div class="text-sm font-semibold">Active Medication & IV Orders</div>
                <div class="flex gap-2">
                  <button type="button" id="normalizeIVs" class="px-3 py-1 bg-white rounded border">Normalize IVs</button>
                  <button type="button" id="addMedRow" class="px-3 py-1 bg-white rounded border">➕ Quick Row</button>
                  <button type="button" data-save="meds" class="px-3 py-1 bg-sky-600 text-white rounded">💾 Save Orders</button>
                </div>
              </div>
              
              <!-- Medications Table -->
              <div class="mb-4">
                <div class="text-sm font-semibold mb-2 text-green-700">MEDICATIONS</div>
                <div class="overflow-x-auto">
                  <table class="w-full text-sm data-table" id="medTable">
                    <thead><tr><th>Drug</th><th>Dosage</th><th>Route</th><th>Frequency</th><th>Start</th><th>Duration</th><th>PRN</th><th>Prescriber</th><th>Action</th></tr></thead>
                    <tbody id="medTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- IV Fluids Table -->
              <div class="mb-4">
                <div class="text-sm font-semibold mb-2 text-blue-700">IV FLUIDS</div>
                <div class="overflow-x-auto">
                  <table class="w-full text-sm data-table" id="ivTable">
                    <thead><tr><th>IV Fluid</th><th>mL/hr</th><th>gtt/min</th><th>Volume</th><th>Time</th><th>Start</th><th>Prescriber</th><th>Action</th></tr></thead>
                    <tbody id="ivTableBody"></tbody>
                  </table>
                </div>
              </div>

              <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <h4 class="font-semibold">Clinical Decision Support (CDS) & Alerts</h4>
                  <div id="cdsPanel" class="mt-2 text-sm text-rose-700"></div>
                </div>
                <div>
                  <h4 class="font-semibold">Medication Audit Trail</h4>
                  <div id="medAuditList" class="mt-2 text-sm muted">No audit records</div>
                </div>
              </div>
            </div>

            <!-- Right: MAR (Medication Administration Record) -->
            <div class="lg:col-span-3 mt-4">
              <h4 class="font-semibold mb-2">Medication Administration Record (MAR)</h4>
              <div id="marWrap" class="border rounded p-3 bg-white/50">
                <table class="w-full text-sm data-table"><thead><tr><th>Time / Date</th><th>Drug</th><th>Dose</th><th>Given by</th><th>Notes</th><th>Action</th></tr></thead>
                  <tbody id="marTableBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- 8 • Messages -->
        <div id="tab-messages" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <h3 class="text-xl font-bold mb-4 flex items-center gap-3">
            💬 Clinical Messages & Alerts
            <span id="unreadCount" class="px-3 py-1 bg-red-500 text-white text-sm rounded-full hidden">0</span>
          </h3>
          
          <!-- Message Controls -->
          <div class="mb-6 flex flex-wrap gap-3 items-center justify-between">
            <div class="flex gap-3">
              <button type="button" id="composeBtn" onclick="if(window.clinicalMessaging) clinicalMessaging.showComposeModal(); else alert('Messaging not ready')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                ✉️ Compose Message
              </button>
              <button type="button" id="templatesBtn" onclick="showMessagingTemplates()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                📋 Templates
              </button>
              <button type="button" id="patientMessagesBtn" onclick="showPatientMessages()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                👤 Patient Messages
              </button>
              <button type="button" id="alertsBtn" onclick="showCriticalAlerts()" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors">
                🚨 System Alerts
              </button>
            </div>
            <div class="flex gap-2">
              <select id="messageFilter" class="px-3 py-2 border rounded-lg">
                <option value="all">All Messages</option>
                <option value="unread">Unread</option>
                <option value="alerts">Alerts</option>
                <option value="clinical">Clinical</option>
                <option value="administrative">Administrative</option>
                <option value="threaded">Threaded</option>
                <option value="patient-linked">Patient Linked</option>
              </select>
              <button type="button" id="refreshMessages" class="px-3 py-2 border rounded-lg hover:bg-gray-50">
                🔄 Refresh
              </button>
            </div>
          </div>

          <!-- Message Threads -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Message List -->
            <div class="lg:col-span-1">
              <h4 class="font-semibold mb-3 flex items-center gap-2">
                📬 Messages 
                <span class="text-sm text-gray-500">(<span id="messageCount">0</span>)</span>
              </h4>
              <div id="messagesList" class="space-y-2 max-h-96 overflow-y-auto">
                <!-- Messages will be populated here -->
              </div>
            </div>

            <!-- Message Content -->
            <div class="lg:col-span-2">
              <div id="messageViewer" class="bg-white rounded-lg border p-4 min-h-96">
                <div class="text-center text-gray-500 py-12">
                  <div class="text-4xl mb-3">💬</div>
                  <p>Select a message to view its content</p>
                </div>
              </div>
              
              <!-- Quick Reply -->
              <div id="quickReply" class="mt-4 hidden">
                <div class="bg-blue-50 p-4 rounded-lg">
                  <h5 class="font-semibold mb-2">Quick Reply</h5>
                  <textarea id="replyText" class="w-full border rounded-lg p-3 mb-3" rows="3" placeholder="Type your reply..."></textarea>
                  <div class="flex justify-end gap-2">
                    <button type="button" id="cancelReply" class="px-4 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                    <button type="button" id="sendReply" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Send Reply</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Critical Alerts Section -->
          <div id="criticalAlerts" class="mt-6 hidden">
            <h4 class="font-semibold text-red-700 mb-3 flex items-center gap-2">
              🚨 Critical Alerts
            </h4>
            <div id="alertsList" class="space-y-2">
              <!-- Critical alerts will be shown here -->
            </div>
          </div>
        </div>

        <!-- 9 • Vitals -->
        <div id="tab-vitals" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <h3 class="text-xl font-bold mb-3">9 • Vitals & Monitoring</h3>
          <form id="form-vitals">
            <div class="grid grid-cols-2 sm:grid-cols-6 gap-3">
              <input name="v_date" id="v_date" type="date" class="rounded-lg p-2 border"/>
              <input name="v_time" id="v_time" type="time" class="rounded-lg p-2 border"/>
              <input name="v_temp" id="v_temp" placeholder="Temp (°C)" class="rounded-lg p-2 border" />
              <input name="v_pulse" id="v_pulse" placeholder="Pulse (bpm)" class="rounded-lg p-2 border" />
              <input name="v_rr" id="v_rr" placeholder="Resp Rate" class="rounded-lg p-2 border" />
              <input name="v_spo2" id="v_spo2" placeholder="SpO2 (%)" class="rounded-lg p-2 border" />
            </div>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mt-2">
              <input name="v_bp" id="v_bp" placeholder="BP (e.g., 120/80)" class="rounded-lg p-2 border" />
              <input name="v_by" id="v_by" placeholder="Recorded by (Full name)" class="rounded-lg p-2 border" />
              <input name="v_io_in" id="v_io_in" placeholder="Intake (mL)" class="rounded-lg p-2 border" />
              <input name="v_io_out" id="v_io_out" placeholder="Output (mL)" class="rounded-lg p-2 border" />
            </div>
            <div class="mt-3 flex gap-2">
              <button type="button" id="btnAddVitals" class="px-4 py-2 bg-white rounded-lg border">➕ Add Vitals Row</button>
              <button type="button" data-save="vitals" class="px-4 py-2 bg-white rounded-lg border">💾 Save Vitals</button>
              <button type="button" id="clearVitals" class="px-4 py-2 bg-white rounded-lg border">Clear</button>
            </div>
            <div id="vitalsTableWrap" class="mt-3 max-h-48 overflow-auto border rounded p-2">
              <table class="w-full text-sm"><thead><tr><th>Date</th><th>Time</th><th>Temp</th><th>P</th><th>RR</th><th>BP</th><th>SpO2</th><th>Intake</th><th>Output</th><th>By</th><th class="text-right">Action</th></tr></thead><tbody id="vitalsTableBody"></tbody></table>
            </div>
          </form>
        </div>

        <!-- 10 • Nurse Notes -->
        <div id="tab-nurse" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <h3 class="text-xl font-bold mb-3">10 • Nurse Notes (FDAR)</h3>
          <form id="form-nurse" class="grid grid-cols-1 gap-3">
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
              <input name="nurse_date" type="date" class="rounded-lg p-2 border" />
              <input name="nurse_time" type="time" class="rounded-lg p-2 border" />
              <input name="nurse_by" placeholder="Nurse full name" class="rounded-lg p-2 border" />
            </div>
            <div>
              <label class="text-sm">F - Focus / Findings</label>
              <textarea name="nurse_f" class="w-full rounded-lg p-3 border" placeholder="Focus / Findings"></textarea>
            </div>
            <div>
              <label class="text-sm">D - Data</label>
              <textarea name="nurse_d" class="w-full rounded-lg p-3 border" placeholder="Objective data / vitals / observations"></textarea>
            </div>
            <div>
              <label class="text-sm">A - Action / Intervention</label>
              <textarea name="nurse_a" class="w-full rounded-lg p-3 border" placeholder="Interventions performed"></textarea>
            </div>
            <div>
              <label class="text-sm">R - Response</label>
              <textarea name="nurse_r" class="w-full rounded-lg p-3 border" placeholder="Patient response to interventions"></textarea>
            </div>
            <div class="mt-3">
              <button type="button" data-save="nurse" class="px-4 py-2 bg-sky-600 text-white rounded-lg">💾 Save Nurse Notes</button>
            </div>
          </form>
        </div>

        <!-- 11 • Doctor Notes -->
        <div id="tab-doctor" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <h3 class="text-xl font-bold mb-3">11 • Doctor Notes</h3>
          <form id="form-doctor" class="grid grid-cols-1 gap-3">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
              <input name="doc_date" type="date" class="rounded-lg p-2 border" />
              <input name="doc_time" type="time" class="rounded-lg p-2 border" />
            </div>
            <div>
              <label class="text-sm">Subjective</label>
              <textarea name="doc_subjective" class="w-full rounded-lg p-3 border" placeholder="Patient's report / symptoms"></textarea>
            </div>
            <div>
              <label class="text-sm">Objective</label>
              <textarea name="doc_objective" class="w-full rounded-lg p-3 border" placeholder="Exam findings, vitals, labs"></textarea>
            </div>
            <div>
              <label class="text-sm">Assessment</label>
              <textarea name="doc_assessment" class="w-full rounded-lg p-3 border" placeholder="Clinical impression / diagnosis"></textarea>
            </div>
            <div>
              <label class="text-sm">Plan</label>
              <textarea name="doc_plan" class="w-full rounded-lg p-3 border" placeholder="Investigations, consults, treatment plan"></textarea>
            </div>
            <div class="mt-3 flex gap-2">
              <button type="button" class="px-4 py-2 bg-sky-600 text-white rounded-lg" data-save="doctor">💾 Save Doctor Notes</button>
              <button type="button" id="clearDoctor" class="px-4 py-2 bg-white rounded-lg border">Clear</button>
            </div>
          </form>
        </div>

        <!-- 12 • Discharge Plan -->
        <div id="tab-plan" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <h3 class="text-xl font-bold mb-3">12 • Discharge Plan</h3>
          <form id="form-plan" class="grid grid-cols-1 gap-3">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label class="text-sm">Discharge Date</label>
                <input name="discharge_date" type="date" class="w-full rounded border px-2 py-1"/>
              </div>
              <div>
                <label class="text-sm">Discharge Time</label>
                <input name="discharge_time" type="time" class="w-full rounded border px-2 py-1"/>
              </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div><label class="text-sm">Final Diagnosis</label><input name="dis_finalDx" class="w-full rounded border px-2 py-1"/></div>
              <div><label class="text-sm">Condition on Discharge</label><input name="dis_condition" class="w-full rounded border px-2 py-1"/></div>
            </div>
            <div>
              <label class="text-sm">Medications on Discharge</label>
              <textarea name="dis_meds" class="w-full rounded border p-2" placeholder="Drugs, dose, frequency"></textarea>
            </div>
            <div>
              <label class="text-sm">Follow-up Appointments</label>
              <input name="dis_followup" class="w-full rounded border p-2" placeholder="Date / Clinic / Notes" />
            </div>
            <div>
              <label class="text-sm">Discharge Instructions / Education</label>
              <textarea name="dis_instructions" class="w-full rounded border p-2" style="min-height:120px" placeholder="Diet, activity, wound care, warning signs"></textarea>
            </div>
            <div class="mt-3 flex gap-2">
              <button type="button" data-save="plan" class="px-4 py-2 bg-sky-600 text-white rounded-lg">💾 Save Discharge Plan</button>
              <button type="button" id="clearPlan" class="px-4 py-2 bg-white rounded-lg border">Clear</button>
            </div>
          </form>
        </div>

        <!-- 13 • Patient Admission/Registration -->
        <div id="tab-admission" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <h3 class="text-xl font-bold mb-4 flex items-center gap-3">
            🏥 Patient Admission & Registration
            <span class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full">Admissions Department</span>
          </h3>
          
          <!-- Patient Registration Form -->
          <div class="bg-white rounded-xl p-6 mb-6 border border-gray-200">
            <h4 class="text-lg font-semibold mb-4 text-gray-800">New Patient Registration</h4>
            
            <!-- Basic Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Medical Record Number</label>
                <input type="text" id="admissionMRN" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Auto-generated" readonly>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                <input type="text" id="admissionFirstName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                <input type="text" id="admissionLastName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Date of Birth *</label>
                <input type="date" id="admissionDOB" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Gender *</label>
                <select id="admissionGender" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                  <option value="">Select Gender</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                <input type="tel" id="admissionPhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="(555) 123-4567">
              </div>
            </div>
            
            <!-- Address Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                <input type="text" id="admissionAddress" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Street Address">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
                <input type="text" id="admissionCity" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Emergency Contact Name</label>
                <input type="text" id="admissionEmergencyContact" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Emergency Contact Phone</label>
                <input type="tel" id="admissionEmergencyPhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              </div>
            </div>
            
            <!-- Admission Details -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Admission Type *</label>
                <select id="admissionType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                  <option value="">Select Type</option>
                  <option value="emergency">Emergency</option>
                  <option value="elective">Elective</option>
                  <option value="urgent">Urgent</option>
                  <option value="observation">Observation</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Department *</label>
                <select id="admissionDepartment" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                  <option value="">Select Department</option>
                  <option value="emergency">Emergency Department</option>
                  <option value="internal-medicine">Internal Medicine</option>
                  <option value="surgery">Surgery</option>
                  <option value="pediatrics">Pediatrics</option>
                  <option value="cardiology">Cardiology</option>
                  <option value="orthopedics">Orthopedics</option>
                  <option value="icu">Intensive Care Unit</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Attending Physician</label>
                <select id="admissionPhysician" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                  <option value="">Select Physician</option>
                  <option value="dr-smith">Dr. Smith</option>
                  <option value="dr-johnson">Dr. Johnson</option>
                  <option value="dr-williams">Dr. Williams</option>
                  <option value="dr-brown">Dr. Brown</option>
                </select>
              </div>
            </div>
            
            <!-- Chief Complaint -->
            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-1">Chief Complaint / Reason for Admission</label>
              <textarea id="admissionComplaint" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Describe the reason for admission..."></textarea>
            </div>
            
            <!-- Insurance Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Insurance Provider</label>
                <input type="text" id="admissionInsurance" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Insurance Company">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Policy Number</label>
                <input type="text" id="admissionPolicyNumber" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Policy/Member ID">
              </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex gap-3">
              <button type="button" id="registerPatientBtn" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                ✅ Register Patient
              </button>
              <button type="button" id="clearAdmissionFormBtn" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                🔄 Clear Form
              </button>
              <button type="button" id="previewAdmissionBtn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                👁️ Preview Registration
              </button>
            </div>
          </div>
          
          <!-- Recent Admissions -->
          <div class="bg-white rounded-xl p-6 border border-gray-200">
            <h4 class="text-lg font-semibold mb-4 text-gray-800">Recent Admissions</h4>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">MRN</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Patient Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">DOB</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Admission Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody id="recentAdmissionsTable" class="bg-white divide-y divide-gray-200">
                  <!-- Admissions will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- 14 • Staff Management -->
        <div id="tab-staff" class="panel hidden p-6 rounded-2xl glass soft-shadow">
          <h3 class="text-xl font-bold mb-4 flex items-center gap-3">
            👥 Staff Management
            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">Healthcare Providers</span>
          </h3>
          
          <!-- Staff Controls -->
          <div class="mb-6 flex flex-wrap gap-3 items-center justify-between">
            <div class="flex gap-3">
              <button type="button" id="addStaffBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                ➕ Add Staff Member
              </button>
              <button type="button" id="viewSchedulesBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                📅 View Schedules
              </button>
              <button type="button" id="departmentStaffBtn" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                🏥 Department Staff
              </button>
              <button type="button" id="credentialsBtn" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors">
                📜 Credentials
              </button>
            </div>
            <div class="flex gap-2">
              <select id="staffFilter" class="px-3 py-2 border rounded-lg">
                <option value="all">All Staff</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="doctors">Doctors</option>
                <option value="nurses">Nurses</option>
                <option value="admin">Administration</option>
                <option value="support">Support Staff</option>
              </select>
              <button type="button" id="refreshStaff" class="px-3 py-2 border rounded-lg hover:bg-gray-50">
                🔄 Refresh
              </button>
            </div>
          </div>

          <!-- Staff Overview Cards -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg">
              <h4 class="font-semibold text-sm opacity-90">Total Staff</h4>
              <p class="text-2xl font-bold" id="totalStaffCount">0</p>
              <p class="text-xs opacity-75">Active members</p>
            </div>
            <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg">
              <h4 class="font-semibold text-sm opacity-90">On Duty</h4>
              <p class="text-2xl font-bold" id="onDutyCount">0</p>
              <p class="text-xs opacity-75">Currently working</p>
            </div>
            <div class="bg-gradient-to-r from-amber-500 to-amber-600 text-white p-4 rounded-lg">
              <h4 class="font-semibold text-sm opacity-90">Departments</h4>
              <p class="text-2xl font-bold" id="departmentCount">8</p>
              <p class="text-xs opacity-75">Active departments</p>
            </div>
            <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-lg">
              <h4 class="font-semibold text-sm opacity-90">Roles</h4>
              <p class="text-2xl font-bold" id="roleCount">12</p>
              <p class="text-xs opacity-75">Different positions</p>
            </div>
          </div>

          <!-- Main Staff Content -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Staff List -->
            <div class="lg:col-span-2">
              <h4 class="font-semibold mb-3 flex items-center gap-2">
                👨‍⚕️ Staff Directory 
                <span class="text-sm text-gray-500">(<span id="staffCount">0</span> members)</span>
              </h4>
              <div id="staffList" class="space-y-3 max-h-96 overflow-y-auto">
                <!-- Staff members will be populated here -->
                <div class="text-center text-gray-500 py-8">
                  <div class="text-4xl mb-3">👥</div>
                  <p>No staff members found</p>
                  <button type="button" class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700" onclick="showAddStaffModal()">
                    Add First Staff Member
                  </button>
                </div>
              </div>
            </div>

            <!-- Staff Details Panel -->
            <div class="lg:col-span-1">
              <div id="staffDetailsPanel" class="bg-white rounded-lg border p-4 min-h-96">
                <div class="text-center text-gray-500 py-12">
                  <div class="text-4xl mb-3">👤</div>
                  <p>Select a staff member to view details</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="mt-6 bg-gray-50 p-4 rounded-lg">
            <h5 class="font-semibold mb-3">Quick Actions</h5>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
              <button type="button" class="p-3 bg-white rounded-lg border hover:bg-gray-50 text-center">
                <div class="text-2xl mb-1">📋</div>
                <div class="text-sm font-medium">Attendance</div>
              </button>
              <button type="button" class="p-3 bg-white rounded-lg border hover:bg-gray-50 text-center">
                <div class="text-2xl mb-1">💰</div>
                <div class="text-sm font-medium">Payroll</div>
              </button>
              <button type="button" class="p-3 bg-white rounded-lg border hover:bg-gray-50 text-center">
                <div class="text-2xl mb-1">📊</div>
                <div class="text-sm font-medium">Reports</div>
              </button>
              <button type="button" class="p-3 bg-white rounded-lg border hover:bg-gray-50 text-center">
                <div class="text-2xl mb-1">⚙️</div>
                <div class="text-sm font-medium">Settings</div>
              </button>
            </div>
          </div>
        </div>

        <!-- End tab forms -->

      </section>
    </div>
  </main>

  <!-- Modal for patient detail (kept from original) -->
  <div id="modal" class="fixed inset-0 z-50 hidden items-center justify-center p-6">
    <div id="modalBody" class="w-full max-w-3xl rounded-2xl glass soft-shadow p-4"></div>
    <button type="button" class="absolute top-6 right-6 btn-ghost" onclick="closeModal()">✕</button>
  </div>

  <!-- Login modal -->
  <div id="loginModal" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900 bg-opacity-60 hidden">
    <div class="w-full max-w-md p-6 rounded-2xl glass soft-shadow text-slate-800">
      <div class="flex items-center gap-4 mb-4">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-sky-600 to-indigo-700 text-white flex items-center justify-center">🩺</div>
        <div>
          <div class="text-lg font-bold">ONE CARE <span class="text-amber-400">SYSTEM</span></div>
          <div class="text-sm text-slate-500">Sign in to continue</div>
        </div>
      </div>
      <div class="space-y-3">
        <form id="loginForm">
          <label class="sr-only" for="loginEmail">Email</label>
          <input id="loginEmail" name="email" type="email" placeholder="Email" class="w-full rounded-lg p-3 border" required />

          <label class="sr-only" for="loginPass">Password</label>
          <div class="relative mt-2">
            <input id="loginPass" name="password" type="password" placeholder="Password" class="w-full rounded-lg p-3 border pr-20" required />
            <button type="button" id="toggleLoginPass" class="absolute right-2 top-1/2 -translate-y-1/2 text-sm text-slate-600 px-2">Show</button>
          </div>

          <div class="flex items-center justify-between mt-3">
            <button type="submit" id="loginBtn" class="btn-primary flex items-center gap-2">
              <span id="loginSpinner" class="hidden w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
              <span id="loginBtnText">Sign in</span>
            </button>
            <button type="button" id="loginCancel" class="btn-ghost">Cancel</button>
          </div>
          <div id="loginError" class="text-sm text-red-600 mt-2 hidden" role="alert"></div>
        </form>
        
        <!-- Role Information -->
        <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
          <h4 class="text-sm font-semibold text-blue-800 mb-2">Available User Roles:</h4>
          <div class="text-xs text-blue-700 space-y-1">
            <div><strong>👑 Administrator:</strong> Full system access</div>
            <div><strong>👨‍⚕️ Doctor:</strong> Complete clinical access</div>
            <div><strong>👩‍⚕️ Nurse:</strong> Clinical access (limited)</div>
            <div><strong>🏥 Admission Staff:</strong> Patient registration & bed management</div>
            <div><strong>🛏️ Bed Navigator:</strong> Patient info, departments & bed management</div>
          </div>
          <div class="text-xs text-blue-600 mt-2 italic">
            Your role is automatically assigned based on your login credentials.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast container (toasts are injected by JS) -->
  <div id="toastContainer" aria-live="polite" class="fixed right-6 bottom-6 z-50"></div>

  <!-- Help Modal -->
  <div id="helpModal" class="fixed inset-0 z-60 hidden items-center justify-center bg-slate-900 bg-opacity-60">
    <div class="w-full max-w-4xl max-h-[90vh] overflow-y-auto p-6 rounded-2xl glass soft-shadow text-slate-800 mx-4">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-600 to-teal-700 text-white flex items-center justify-center">❓</div>
          <div>
            <div class="text-xl font-bold">Help & Documentation</div>
            <div class="text-sm text-slate-500">Quick guide to using the EHR system</div>
          </div>
        </div>
        <button id="closeHelpModal" class="btn-ghost">✕</button>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-4">
          <div class="bg-emerald-50 p-4 rounded-lg border border-emerald-200">
            <h3 class="font-semibold text-emerald-800 mb-2">🏠 Dashboard</h3>
            <ul class="text-sm text-emerald-700 space-y-1">
              <li>• View patient census and statistics</li>
              <li>• Monitor vitals and medications</li>
              <li>• Access quick actions</li>
              <li>• Filter patient timeline</li>
            </ul>
          </div>
          
          <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
            <h3 class="font-semibold text-blue-800 mb-2">👤 Patient Information</h3>
            <ul class="text-sm text-blue-700 space-y-1">
              <li>• Complete demographics required</li>
              <li>• Age auto-calculates from DOB</li>
              <li>• Use "Demo Data" for testing</li>
              <li>• Validate before saving</li>
            </ul>
          </div>
          
          <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
            <h3 class="font-semibold text-purple-800 mb-2">🔍 Physical Assessment</h3>
            <ul class="text-sm text-purple-700 space-y-1">
              <li>• BMI calculates automatically</li>
              <li>• Initial diagnosis required</li>
              <li>• Complete all system reviews</li>
            </ul>
          </div>
        </div>
        
        <div class="space-y-4">
          <div class="bg-green-50 p-4 rounded-lg border border-green-200">
            <h3 class="font-semibold text-green-800 mb-2">💊 Medications & IV</h3>
            <ul class="text-sm text-green-700 space-y-1">
              <li>• Use CPOE for new orders</li>
              <li>• Separate medication and IV tables</li>
              <li>• Normalize IVs feature available</li>
              <li>• MAR tracks administration</li>
            </ul>
          </div>
          
          <div class="bg-amber-50 p-4 rounded-lg border border-amber-200">
            <h3 class="font-semibold text-amber-800 mb-2">📊 Vitals & Monitoring</h3>
            <ul class="text-sm text-amber-700 space-y-1">
              <li>• Record with date and time</li>
              <li>• Include intake/output</li>
              <li>• Automatic validation</li>
            </ul>
          </div>
          
          <div class="bg-teal-50 p-4 rounded-lg border border-teal-200">
            <h3 class="font-semibold text-teal-800 mb-2">📝 Documentation</h3>
            <ul class="text-sm text-teal-700 space-y-1">
              <li>• Nurse Notes: Use FDAR format</li>
              <li>• Doctor Notes: SOAP format</li>
              <li>• Auto-save functionality</li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="mt-6 p-4 bg-slate-50 rounded-lg border">
        <h3 class="font-semibold text-slate-800 mb-2">🔧 Tips & Shortcuts</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-700">
          <ul class="space-y-1">
            <li>• Press "/" to focus search</li>
            <li>• Use Tab to navigate forms</li>
            <li>• Required fields marked with *</li>
          </ul>
          <ul class="space-y-1">
            <li>• Green borders = valid input</li>
            <li>• Red borders = missing/invalid</li>
            <li>• Auto-refresh every 30 seconds</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom horizontal tab bar (cloned from sidebar via JS) -->
  <div id="bottomNavWrap" class="fixed left-0 right-0 bottom-0 z-40 p-2 flex justify-center hidden">
    <nav id="bottomNav" class="bg-white/80 glass rounded-xl px-3 py-2 flex gap-2 items-center"></nav>
  </div>

  <!-- Firebase SDKs (v8) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <!-- Chart.js for enhanced data visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>

  <!-- Core Application -->
  <script src="./app.js" onerror="console.error('Failed to load app.js - critical error!')"></script>
  
  <!-- Deployment Status Check -->
  <script>
    // Production deployment status checker
    window.deploymentStatus = {
      environment: window.location.hostname.includes('vercel.app') ? 'production' : 'development',
      timestamp: new Date().toISOString(),
      modules: {
        firebase: typeof firebase !== 'undefined',
        chartjs: typeof Chart !== 'undefined',
        tailwind: !!document.querySelector('script[src*="tailwindcss"]')
      }
    };
    
    console.log('🚀 EHR Deployment Status:', window.deploymentStatus);
    
    // Error logging for development (no user-facing messages)
    window.addEventListener('error', function(e) {
      console.error('JavaScript Error:', e.error);
      // Only log errors, don't show disruptive messages since features are working
    });
  </script>

  <!-- Enhanced functionality -->
  <script>
    // Enhanced Dashboard Functions
    function navigateToTab(tabId) {
      const button = document.querySelector(`[data-target="${tabId}"]`);
      if (button) button.click();
    }
    
    function showAllPatients() {
      // This function can be enhanced to show a modal with all patients
      navigateToTab('tab-dashboard');
      const container = document.getElementById('patientsContainer');
      if (container) {
        container.scrollIntoView({ behavior: 'smooth' });
      }
    }
    
    function refreshDashboard() {
      // Refresh dashboard data
      const refreshBtn = document.getElementById('refreshDashboard');
      if (refreshBtn) {
        refreshBtn.innerHTML = '⟳';
        refreshBtn.style.animation = 'spin 1s linear infinite';
        
        // Simulate refresh
        setTimeout(() => {
          refreshBtn.innerHTML = '🔄';
          refreshBtn.style.animation = '';
          updateLastUpdated();
          if (window.showToast) {
            showToast('Dashboard refreshed', 'success');
          }
        }, 1000);
      }
    }
    
    function updateLastUpdated() {
      const elem = document.getElementById('lastUpdated');
      if (elem) {
        const now = new Date();
        elem.textContent = `Updated ${now.toLocaleTimeString()}`;
      }
    }
    
    // Auto-calculate age from date of birth
    function calculateAge() {
      const dobInput = document.getElementById('info_dob');
      const ageInput = document.getElementById('info_age');
      
      if (dobInput && ageInput) {
        dobInput.addEventListener('change', function() {
          const dob = new Date(this.value);
          const today = new Date();
          let age = today.getFullYear() - dob.getFullYear();
          const monthDiff = today.getMonth() - dob.getMonth();
          
          if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
            age--;
          }
          
          ageInput.value = age >= 0 ? age : '';
        });
      }
    }
    
    // Form validation
    function setupFormValidation() {
      const form = document.getElementById('form-info');
      if (form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          validatePatientInfo();
        });
      }
      
      // Real-time validation
      const requiredFields = form?.querySelectorAll('[required]');
      requiredFields?.forEach(field => {
        field.addEventListener('blur', function() {
          validateField(this);
        });
      });
    }
    
    function validateField(field) {
      const isValid = field.checkValidity();
      field.classList.toggle('border-red-500', !isValid);
      field.classList.toggle('border-green-500', isValid && field.value);
    }
    
    function validatePatientInfo() {
      const form = document.getElementById('form-info');
      const status = document.getElementById('infoStatus');
      
      if (form && status) {
        const isValid = form.checkValidity();
        
        status.className = `p-3 rounded-lg ${isValid ? 'bg-green-100 text-green-800 border border-green-200' : 'bg-red-100 text-red-800 border border-red-200'}`;
        status.textContent = isValid ? '✓ All required fields are completed' : '⚠ Please complete all required fields';
        status.classList.remove('hidden');
        
        if (isValid && window.showToast) {
          showToast('Patient information validated successfully', 'success');
        }
      }
    }
    
    // Demo data function
    function fillDemoData() {
      const demoData = {
        mrn: 'MRN' + Math.random().toString().substr(2, 6),
        patientStatus: 'Inpatient',
        roomNo: '201A',
        bedNo: 'Bed 1',
        admissionDate: new Date().toISOString().split('T')[0],
        admissionTime: '14:30',
        physician: 'Dr. Maria Santos',
        referralSource: 'Emergency Department',
        name: 'Dela Cruz, Juan Carlos',
        civilStatus: 'Married',
        dob: '1985-03-15',
        gender: 'Male',
        contact: '+63 917 123 4567',
        email: 'juan.delacruz@email.com',
        address: '123 Main Street, Quezon City, Metro Manila 1100',
        language: 'Filipino',
        ethnicity: 'Filipino',
        occupation: 'Teacher',
        employer: 'ABC Elementary School',
        emg_name: 'Dela Cruz, Maria',
        emg_relation: 'Spouse',
        emg_phone: '+63 917 765 4321'
      };
      
      Object.keys(demoData).forEach(key => {
        const element = document.getElementById(`info_${key}`);
        if (element) {
          element.value = demoData[key];
          if (element.type === 'date' && key === 'dob') {
            // Trigger age calculation
            element.dispatchEvent(new Event('change'));
          }
        }
      });
      
      if (window.showToast) {
        showToast('Demo data filled', 'info');
      }
    }
    
    // Enhanced search functionality
    function setupSearchFilters() {
      const searchInput = document.getElementById('patientSearch');
      const statusFilter = document.getElementById('patientStatusFilter');
      
      if (searchInput) {
        searchInput.addEventListener('input', debounce(filterPatients, 300));
      }
      
      if (statusFilter) {
        statusFilter.addEventListener('change', filterPatients);
      }
    }
    
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
    
    function filterPatients() {
      // This would connect to the existing patient filtering logic
      console.log('Filtering patients...');
    }
    
    // Timeline filter functionality
    function setupTimelineFilters() {
      const filterButtons = document.querySelectorAll('.timeline-filter-btn');
      filterButtons.forEach(btn => {
        btn.addEventListener('click', function() {
          filterButtons.forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          filterTimelineEvents(this.dataset.filter);
        });
      });
    }
    
    function filterTimelineEvents(filter) {
      console.log('Filtering timeline by:', filter);
      // This would connect to timeline filtering logic
    }
    
    // Initialize enhanced features when page loads
    document.addEventListener('DOMContentLoaded', function() {
      calculateAge();
      setupFormValidation();
      setupSearchFilters();
      setupTimelineFilters();
      updateLastUpdated();
      
      // Wire up demo data button
      const demoBtn = document.getElementById('autoFillDemo');
      if (demoBtn) {
        demoBtn.addEventListener('click', fillDemoData);
      }
      
      // Wire up validate button
      const validateBtn = document.getElementById('validateInfo');
      if (validateBtn) {
        validateBtn.addEventListener('click', validatePatientInfo);
      }
      
      // Wire up refresh button
      const refreshBtn = document.getElementById('refreshDashboard');
      if (refreshBtn) {
        refreshBtn.addEventListener('click', refreshDashboard);
      }
      
      // Wire up help modal
      const helpBtn = document.getElementById('helpBtn');
      const helpModal = document.getElementById('helpModal');
      const closeHelpBtn = document.getElementById('closeHelpModal');
      
      if (helpBtn && helpModal) {
        helpBtn.addEventListener('click', () => {
          helpModal.classList.remove('hidden');
          helpModal.classList.add('flex');
          document.body.classList.add('overflow-hidden');
        });
      }
      
      if (closeHelpBtn && helpModal) {
        closeHelpBtn.addEventListener('click', () => {
          helpModal.classList.add('hidden');
          helpModal.classList.remove('flex');
          document.body.classList.remove('overflow-hidden');
        });
      }
      
      // Close help modal on background click
      if (helpModal) {
        helpModal.addEventListener('click', (e) => {
          if (e.target === helpModal) {
            helpModal.classList.add('hidden');
            helpModal.classList.remove('flex');
            document.body.classList.remove('overflow-hidden');
          }
        });
      }
    });
    
    // CSS for spin animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
